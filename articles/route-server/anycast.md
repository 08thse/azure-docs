---
title: 'Propagating anycast routes to on-premises'
description: Learn about how to advertise the same route from different regions with Azure Route Server.
services: route-server
author: jomore
ms.service: route-server
ms.topic: conceptual
ms.date: 02/03/2022
ms.author: jomore
---

# Anycast routing with Azure Route Server

Although spreading an application across Availability Zones in a single region will result in a higher availability, often times applications need to be deployed in multiple regions, either to achieve a higher resiliency, a better performance for users across the globe, or better business continuity. There are different approaches that can be taken to direct users to one of the locations where a multi-region application is deployed to: DNS-based approaches such as [Azure Traffic Manager](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) or routing-based services like [Azure Front Door](https://docs.microsoft.com/azure/frontdoor/front-door-overview) or the [Azure Cross-Regional Load Balancer](https://docs.microsoft.com/azure/load-balancer/cross-region-overview).

The aforementioned services are recommended for getting users to the best application location over the public Internet using public IP addressing, but they don't support private networks and IP addresses. This document will explore the usage of a route-based approach (anycast) to provide multi-regional, private-networked application deployments.

Anycast essentially consists of advertising exactly the same IP address from more than one location, so that packets from the application users are routed to the closest (in terms of routing) region. Providing multi-region reachability over anycast offers some advantages over DNS-based approaches, such as not having to relay on clients not caching their DNS answers, and not requiring to modify the DNS design of the application.

## Topology

In the design covered in this scenario, the same IP address will be advertised from VNets in different Azure regions, where NVAs will advertise the application's IP address through Azure Route Server. The following diagram depicts two simple hub and spoke topologies, each in a different Azure region. A Network Virtual Appliance (NVA) in each region advertises the same route (`a.b.c.d/32` in this example, it could be any prefix that ideally does not overlap with the Azure and on-premises networks) to its local Azure Route Server. The routes will be further propagated to the on-premises network through ExpressRoute. When application users want to access the application from on-premises, the DNS infrastructure (not covered by this document) will resolve the DNS name of the application to the anycast IP address (`a.b.c.d` in the diagram), which the on-premises network devices will route to one of the two regions.

:::image type="content" source="./media/senarios/anycast.png" alt-text="Diagram of anycast with Route Server.":::

The decision of which of the available regions is selected is entirely based on routing attributes. If the routes from both regions are identical, the on-premises network will typically use Equal Cost MultiPathing (ECMP) to send each application flow to each region. It is possible as well to modify the advertisements generated by each NVA in Azure to make one of the regions preferred, for example with BGP AS Path prepending.

> [!IMPORTANT]
> The NVAs advertising the routes should include some health check mechanism to stop advertising the route when the application is not available in their respective regions.

When the application traffic from the client arrives to one of the NVAs, it will either reverse-proxy the connection or perform Destination Network Address Translation (DNAT) to the actual application. The application will typically reside in a spoke VNet peered to the hub VNet where the NVA is deployed. Traffic back from the application needs to be attracted by the NVA too, which would happen naturally if the NVA is reverse-proxying the connection, or can be achieved with Source Network Address Translation (SNAT) or User Defined Routes (UDRs) in the application subnet. This is no different of providing access to an application in a single region, hence it is not covered in this article.

## Next steps

* [Learn how Azure Route Server works with ExpressRoute](expressroute-vpn-support.md)
* [Learn how Azure Route Server works with a network virtual appliance](resource-manager-template-samples.md)
