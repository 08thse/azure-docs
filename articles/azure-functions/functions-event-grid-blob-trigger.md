---
title: Azure Functions Event Grid Blob Trigger
description: Learn to setup and debug with the Event Grid Blob Trigger
author: cachai2

ms.topic: conceptual
ms.date: 3/1/21
ms.author: cachai
---

# Azure Function Event Grid Blob Trigger

The Event Grid Blob trigger is still in preview. This article demonstrates how to setup and debug a local function that uses an Event Grid Blob trigger to handle events raised by a storage account. It also details how to deploy the trigger to Azure.

## Prerequisites

- Create or use an existing function app
- Create or use an existing storage account
- Have version 5.0+ of the [Microsoft.Azure.WebJobs.Extensions.Storage extension](https://www.nuget.org/packages/Microsoft.Azure.WebJobs.Extensions.Storage/5.0.0-beta.2) installed.
- Download [ngrok](https://ngrok.com/) to allow Azure to call your local function

## Create a new function

1. Open your function app in Visual Studio Code.

1. **Press F1** to create a new blob trigger function. Make sure to use the connection string for your storage account.

1. Once the function is created, add the Event Grid source parameter.

# [C#](#tab/csharp)
Add **Source = BlobTriggerSource.EventGrid** to the function parameters.

# [C# Script](#tab/csharp-script)
Add **"source": "EventGrid"** to the function.json parameters.

# [Java](#tab/java)
Add **"source": "EventGrid"** to the function.json parameters.

# [JavaScript](#tab/javascript)
Add **"source": "EventGrid"** to the function.json parameters.

# [PowerShell](#tab/powershell)
Add **"source": "EventGrid"** to the function.json parameters.

# [Python](#tab/python)
Add **"source": "EventGrid"** to the function.json parameters.

---

1. Then, set a breakpoint in your function on the line that handles logging.

1. Next, **press F5** to start a debugging session.

## Allow Azure to call your local function

To break into a function being debugged on your machine, you must enable a way for Azure to communicate with your local function from the cloud.

The [ngrok](https://ngrok.com/) utility provides a way for Azure to call the function running on your machine. Start *ngrok* using the following command:

```bash
ngrok http -host-header=localhost 7071
```
As the utility is set up, the command window should look similar to the following screenshot:

![Screenshot that shows the Command Prompt after starting the "ngrok" utility.](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-ngrok.png)

Copy the **HTTPS** URL generated when *ngrok* is run. This value is used when configuring the event grid event endpoint.

## Add a storage event

1. Open the Azure portal and navigate to your storage account and select the **Events** option from the left menu.

    ![Add storage account event](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-add-event.png)

1. In the *Events* window, select the **Event Subscription** button. 

1. In the *Event Subscription* window, select the *Endpoint Type* dropdown and select **Web Hook**.

    ![Select subscription type](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-event-subscription-type.png)

1. Once the endpoint type is configured, click on **Select an endpoint** to configure the endpoint value.

    ![Select endpoint type](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-event-subscription-endpoint.png)

    The *Subscriber Endpoint* value is made up from three different values. The prefix is the HTTPS URL generated by *ngrok*. The  remainder of the URL comes from the URL found in the function code file, with the function name added at the end. Starting with the URL from the function code file, the *ngrok* URL replaces `http://localhost:7071` and the function name replaces `{functionname}`.

1. The following screenshot shows how the final URL should look:

    ![Endpoint selection](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-event-subscription-endpoint-selection.png)

1. Once you've entered the appropriate value, click **Confirm Selection**.

> [!IMPORTANT]
> Every time you start *ngrok*, the HTTPS URL is regenerated and the value changes. Therefore you must create a new Event Subscription each time you expose your function to Azure via *ngrok*.

## Upload a file

Now you can upload a file to your storage account to trigger an Event Grid event for your local function to handle. 

Open [Storage Explorer](https://azure.microsoft.com/features/storage-explorer/) and connect to the your storage account. 

- Expand **Blob Containers** 
- Right-click and select **Create Blob Container**.
- Name the container **samples-workitems**
- Select the *samples-workitems* container
- Click the **Upload** button
- Click **Upload Files**
- Select a file and upload it to the blob container

## Debug the function

Once the Event Grid recognizes a new file is uploaded to the storage container, the break point is hit in your local function.

![Start ngrok](./media/functions-debug-event-grid-trigger-local/functions-debug-event-grid-trigger-local-breakpoint.png)

## Deployment

When deploying your function app to Azure, you'll need to update the webhook endpoint from your local endpoint to your deployed app endpoint. To do this, follow the steps in [Add a storage event](#add-a-storage-event) and use the below for the webhook url in step 5.

```http
https://[functionAppName].azurewebsites.net/runtime/webhooks/blobs?functionName=Function1&code=[blobExtensionKey]
```

## Clean up resources

To clean up the resources created in this article, delete the **test** container in your storage account.

## Next steps

- [Automate resizing uploaded images using Event Grid](../event-grid/resize-images-on-storage-blob-upload-event.md)
- [Event Grid trigger for Azure Functions](./functions-bindings-event-grid.md)
