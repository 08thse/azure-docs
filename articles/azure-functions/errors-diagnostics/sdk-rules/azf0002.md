---
title: "AZF0002: Avoid non-static HttpClient usage"
description: "Learn about code analysis rule AZF0002: Avoid non-static HttpClient usage"
author: kashimiz
ms.author: kashimiz
ms.topic: troubleshooting
ms.date: 09/29/2021
---

# AZF0002: Avoid non-static HttpClient usage

This rule is triggered when an [HttpClient](../../../dotnet/api/system.net.http.httpclient?view=netcore-3.1&preserve-view=true) is instantiated within a `[FunctionName]`-decorated method.

| | Value |
|-|-|
| **Rule ID** |AZF0002|
| **Category** |[Performance]|
| **Severity** |Warning|

## Rule description

To avoid holding on to more connections than your Function app needs, best practice is to reuse client instances. A single, static instance of [HttpClient](../../../dotnet/api/system.net.http.httpclient?view=netcore-3.1&preserve-view=true) can manage connections on your behalf. However, instantiating an `HttpClient` within the body of a function will create a new client instance with every function invocation, preventing connection pooling and reuse between instances. On the Consumption plan, inefficient connection management can lead to exhausting outbound connection limits.

## How to fix violations

1. Move your `HttpClient` instantiation to a static instance defined outside of the function. See [example](../../manage-connections?tabs=csharp#http-requests)

2. Supply an `HttpClient` to your functions with [dependency injection](../../functions-dotnet-dependency-injection) **(recommended.)**

## When to suppress the rule

This rule should not be suppressed.

## Next steps

For more information about connection management best practices, see [Manage connections in Azure Functions](../../manage-connections).
