---
title: Reference - Azure Policy guest configuration baseline for Docker
description: Details of the Docker baseline on Azure implemented through Azure Policy guest configuration.
ms.date: 05/17/2022
ms.topic: reference
ms.custom: generated
---
# Docker security baseline

This article details the configuration settings for Docker hosts as applicable in the following
implementations:

- **\[Preview\]: Linux machines should meet requirements for the Azure security baseline for Docker hosts**
- **Vulnerabilities in security configuration on your machines should be remediated** in Azure
  Security Center

For more information, see [Understand the guest configuration feature of Azure Policy](../concepts/guest-configuration.md) and
[Overview of the Azure Security Benchmark (V2)](../../../security/benchmarks/overview.md).

## General security controls

|Name<br /><sub>(CCEID)</sub> |Details |Remediation check |
|---|---|---|
|Docker inventory Information<br /><sub>(0.0)</sub> |Description: None |None |
|Ensure a separate partition for containers has been created<br /><sub>(1.01)</sub> |Description: Docker depends on `/var/lib/docker` as the default directory where all Docker related files, including the images, are stored. This directory might fill up fast and soon Docker and the host could become unusable. So, it is advisable to create a separate partition (logical volume) for storing Docker files. |For new installations, create a separate partition for `/var/lib/docker` mount point. For systems that were previously installed, use the Logical Volume Manager (LVM) to create partitions. |
|Ensure docker version is up-to-date<br /><sub>(1.03)</sub> |Description: Using up-to-date docker version will keep your host secure |Follow the docker documentation in aim to upgrade your version |
|Ensure auditing is configured for the docker daemon<br /><sub>(1.05)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit Docker daemon as well. Docker daemon runs with root privileges. It is thus necessary to audit its activities and usage. |Add the line '-w /usr/bin/docker -k docker' into the /etc/audit/audit.rules file. Then, restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - /var/lib/docker<br /><sub>(1.06)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. /var/lib/docker is one such directory. It holds all the information about containers. It must be audited. |Add the line '-w /var/lib/docker -k docker' into the /etc/audit/audit.rules file. Then, restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - /etc/docker<br /><sub>(1.07)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. /etc/docker is one such directory. It holds various certificates and keys used for TLS communication between Docker daemon and Docker client. It must be audited. |Add the line '-w /etc/docker -k docker' into the /etc/audit/audit.rules file. Then, restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - docker.service<br /><sub>(1.08)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. docker.service is one such file. The docker.service file might be present if the daemon parameters have been changed by an administrator. It holds various parameters for Docker daemon. It must be audited, if applicable. |Find out the 'docker.service' file location by running: 'systemctl show -p FragmentPath docker.service' and add the line '-w {docker.service file location} -k docker' into the /etc/audit/audit.rules file where {docker.service file location} is the file path you have found earlier. Restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - docker.socket<br /><sub>(1.09)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. docker.socket is one such file. It holds various parameters for Docker daemon socket. It must be audited, if applicable. |Find out the 'docker.socket' file location by running: 'systemctl show -p FragmentPath docker.socket' and add the line '-w {docker.socket file location} -k docker' into the /etc/audit/audit.rules file where {docker.socket file location} is the file path you have found earlier. Restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - /etc/default/docker<br /><sub>(1.10)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. /etc/default/docker is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable. |Add the line '-w /etc/default/docker -k docker' into the /etc/audit/audit.rules file. Then, restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - /etc/docker/daemon.json<br /><sub>(1.11)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. /etc/docker/daemon.json is one such file. It holds various parameters for Docker daemon. It must be audited, if applicable. |Add the line '-w /etc/docker/daemon.json -k docker' into the /etc/audit/audit.rules file. Then, restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - /usr/bin/docker-containerd<br /><sub>(1.12)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. /usr/bin/docker-containerd is one such file. Docker now relies on containerdand runC to spawn containers. It must be audited, if applicable. |Add the line '-w /usr/bin/docker-containerd -k docker' into the /etc/audit/audit.rules file. Then, restart the audit daemon by running the command: 'service auditd restart' |
|Ensure auditing is configured for Docker files and directories - /usr/bin/docker-runc<br /><sub>(1.13)</sub> |Description: Apart from auditing your regular Linux file system and system calls, audit all Docker related files and directories. Docker daemon runs with root privileges. Its behavior depends on some key files and directories. /usr/bin/docker-runc is one such file. Docker now relies on containerd and runC to spawn containers. It must be audited, if applicable. |Add the line '-w /usr/bin/docker-runc -k docker' into the /etc/audit/audit.rules file. Then, restart the audit daemon by running the command: 'service auditd restart' |
|Ensure network traffic is restricted between containers on the default bridge<br /><sub>(2.01)</sub> |Description: The inter-container communication would be disabled on the default network bridge. If any communication between containers on the same host is desired, then it needs to be explicitly defined using container linking or alternatively custom networks have to be defined. |Run the docker in daemon mode and pass --icc=false as an argument or set the 'icc' setting to false in the daemon.json file. Alternatively, you can follow the Docker documentation and create a custom network and only join containers that need to communicate to that custom network. The --icc parameter only applies to the default docker bridge, if custom networks are used then the approach of segmenting networks should be adopted instead. |
|Ensure the logging level is set to 'info'.<br /><sub>(2.02)</sub> |Description: Setting up an appropriate log level, configures the Docker daemon to log events that you would want to review later. A base log level of `info` and above would capture all logs except debug logs. Until and unless required, you should not run Docker daemon at `debug` log level. |Run the Docker daemon as below: ```dockerd --log-level info``` |
|Ensure Docker is allowed to make changes to iptables<br /><sub>(2.03)</sub> |Description: Docker will never make changes to your system `iptables` rules if you choose to do so. Docker server would automatically make the needed changes to iptables based on how you choose your networking options for the containers if it is allowed to do so. It is recommended to let Docker server make changes to `iptables`automatically to avoid networking misconfiguration that might hamper the communication between containers and to the outside world. Additionally, it would save you hassles of updating `iptable`every time you choose to run the containers or modify networking options. |Do not run the Docker daemon with `--iptables=false` parameter. For example, do not start the Docker daemon as below: ```dockerd --iptables=false``` |
|Ensure insecure registries are not used<br /><sub>(2.04)</sub> |Description: You should not be using any insecure registries in the production environment. Insecure registries can be tampered with leading to possible compromise to your production system. |remove '--insecure-registry' flag from the dockerd start command |

> [!NOTE]
> Availability of specific Azure Policy guest configuration settings may vary in Azure Government
> and other national clouds.

## Next steps

Additional articles about Azure Policy and guest configuration:

- [Understand the guest configuration feature of Azure Policy]Understand the guest configuration feature of Azure Polic(../concepts/guest-configuration.md).
- [Regulatory Compliance](../concepts/regulatory-compliance.md) overview.
- Review other examples at [Azure Policy samples](./index.md).
- Review [Understanding policy effects](../concepts/effects.md).
- Learn how to [remediate non-compliant resources](../how-to/remediate-resources.md).
