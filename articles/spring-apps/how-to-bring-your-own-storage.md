---
title: Bring your own storage to Azure Spring Apps
description: Learn how to bring in storage from an external source into Azure Spring Appss.
author: karlerickson
ms.author: yitaopan
ms.service: spring-apps
ms.topic: how-to
ms.date: 03/8/2023
ms.custom: devx-track-java
---

# Bring your own storage to Azure Spring Apps

This article describes how to enable your own persistent storage in Azure Spring Apps. Your own storage and the built-in persistent storage in Azure Spring Apps differ in the following ways:

- In built-in storage, artifacts generated by your application get uploaded into Azure Storage Accounts. In your own storage, artifacts generated by your application get uploaded into a storage account that you control.

- In built-in storage, Microsoft Azure controls the encryption-at-rest and the lifetime management policies for those artifacts. In your own storage, you control the encryption-at-rest policy, the lifetime management policy, and network access.

In addition, you can your can mount your own persistent storage to not only Azure Spring Apps but to other instances in the environment such as Azure Container Apps. This capability is possible because your Azure Spring Apps instance is deployed in the Azure Container Apps Environment.

## Prerequisites

- Read and complete each scenario prior to proceeding:
  - [Create Azure Spring Apps Consumption Plan (Standard Gen2)](./create-asa-standard-gen2.md)
  - [Build and deploy Spring apps](./create-and-deploy-apps.md)

## Step 1: Set up the environment

Set the following variables to the names of your resources.

```bash
RESOURCE_GROUP="<resource-group-name>"
LOCATION="<location>"
MANAGED_ENVIRONMENT="<azure-container-apps-environment-name>"
SPRING_APPS_NAME="<azure-spring-apps-instance-name>"
APP_NAME="<spring-app-name>"
```

## Step 2: Set up a storage account

Create a storage account and establish a file share to mount to the spring app.

1. Define a storage account name.

   This command generates a random suffix to the storage account name to ensure uniqueness.

   ```azurecli
   STORAGE_ACCOUNT_NAME="myasastorageaccount$RANDOM"
   ```

1. Create an Azure Storage account.

   ```azurecli
   az storage account create \
     --resource-group $RESOURCE_GROUP \
     --name $STORAGE_ACCOUNT_NAME \
     --location "$LOCATION" \
     --kind StorageV2 \
     --sku Standard_LRS \
     --enable-large-file-share \
     --query provisioningState
   ```

   This command returns a success message upon a successful completion.

1. Define a file share name.

   ```bash
   FILE_SHARE_NAME="<file-share-name>"
   ```

1. Create the Azure Storage file share.

   ```azurecli
   az storage share-rm create \
     --resource-group $RESOURCE_GROUP \
     --storage-account $STORAGE_ACCOUNT_NAME \
     --name $FILE_SHARE_NAME \
     --quota 1024 \
     --enabled-protocols SMB \
     --output table
   ```

1. Get the Storage Account key.

   ```bash
   STORAGE_ACCOUNT_KEY=`az storage account keys list -n $STORAGE_ACCOUNT_NAME --query "[0].value" -o tsv`
   ```

The storage account key is required to create the storage link in your Azure Container Apps Environment.

## Step 3: Link the storage to the managed environment

1. Define the storage mount name.

   ```bash
   STORAGE_MOUNT_NAME="<storage-account-name>"
   ```

1. Create the storage link in the Azure Container Apps Environment. This command creates a link between the environment and the file share created with the `az storage share-rm` command.

   ```azurecli
   az containerapp env storage set \
     --access-mode ReadWrite \
     --azure-file-account-name $STORAGE_ACCOUNT_NAME \
     --azure-file-account-key $STORAGE_ACCOUNT_KEY \
     --azure-file-share-name $FILE_SHARE_NAME \
     --storage-name $STORAGE_MOUNT_NAME \
     --name $MANAGED_ENVIRONMENT \
     --resource-group $RESOURCE_GROUP \
     --output table
   ```

Now that the storage account and environment are linked, you can use the storage mount in your Azure Spring Apps instance.

## Step 4: Add storage to an app

Add the persistent storage to your existing app.

```azurecli
az spring app append-persistent-storage \
    --resource-group $RESOURCE_GROUP \
    --service $SPRING_APPS_NAME \
    --name $APP_NAME \
    --persistent-storage-type AzureFileVolume \
    --mount-path /var/log/nginx \
    --storage-name STORAGE_MOUNT_NAME
```

## Next steps
