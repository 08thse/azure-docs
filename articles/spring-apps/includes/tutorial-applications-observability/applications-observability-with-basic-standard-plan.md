---
author: karlerickson
ms.author: v-shilichen
ms.service: spring-apps
ms.topic: include
ms.date: 09/15/2023
---

<!-- 
For clarity of structure, a separate markdown file is used to describe how to observe the application with Basic/Standard plan.

[!INCLUDE [tutorial-applications-observability-with-basic-standard-plan](includes/tutorial-applications-observability/applications-observability-with-basic-standard-plan.md)]

-->

## 2. Monitor the application

Azure Spring Apps provides several metrics by default, which includes availability, performance, HTTP request, database connection, and more. These metrics are important to clarify goals, find improvements, and formulate specific improvement measures. For more information, see [Metrics for Azure Spring Apps](../../concept-metrics.md). 

This section provides information on how to use metrics of your application and monitor the metrics in an Azure dashboard using the key metrics charts generated by the Azure Spring Apps and Application Insights.

### 2.1. Add metrics to monitor resource utilization

This section explains how to use the default metrics defined by Spring Boot, and custom metrics defined in the application code. These metrics are available for applications running on Azure Spring Apps. 

#### Add metrics defined by Spring Boot

Spring Boot registers several metrics, such as JVM. The following example uses `JVM Memory` as an example, but to add other interested metrics defined by Spring Boot, use the following steps: 

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. On the left navigation menu, select **Metrics**, select the edit icon in the chart title, and then rename the chart title to `JVM Memory Used`.

1. Select **Add metric**. For **Metric**, select the corresponding dropdown list to choose the **jvm_memory_used** metric under the **Log-based metrics** namespace, and then select `Avg` for **Avg**.

1. Select **Apply splitting**. For **Values**, select the corresponding dropdown list to check the **Cloud role name** box.

:::image type="content" source="../../media/tutorial-applications-observability/jvm-memory-used-chart.png" alt-text="Screenshot of the Azure portal that shows the Azure Spring Apps instance jvm memory used page." lightbox="../../media/tutorial-applications-observability/jvm-memory-used-chart.png":::

> [!NOTE]
> The metrics are available after the application is deployed and running.

#### Add custom metrics defined in application code

In the PetClinic's source code, the REST controllers are annotated with the micrometer `@Timed` annotation. This annotation collects metrics like the number of times a method is called or the execution time of a method. 

The following are the custom metrics details: 

- `petclinic.owner` and `petclinic.pet` defined in the `customers-service` application.
- `petclinic.visit` defined in the `visits-service` application.

You can define a chart `REST API access` with custom metrics, and update the **Aggregation** to `Count` for each metric.

:::image type="content" source="../../media/tutorial-applications-observability/custom-metrics.png" alt-text="Screenshot of the Azure portal that shows the Azure Spring Apps instance overview page." lightbox="../../media/tutorial-applications-observability/custom-metrics.png":::

### 2.2. Monitor the availability of the application

To check the liveness for each app on Azure Spring Apps, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. Select **Availability**, and then select **Add Standard test** to add a test.

1. On the **Create Standard test** page, perform following steps:

- **Test name**: Enter `api-gateway` for API gateway app
- **URL**: Enter `https://[your-Azure-Spring-Apps-instance-name]-api-gateway.azuremicroservices.io/actuator/health/liveness` for the corresponding URL 
- **Success criteria**: Extend the option 
- **Content match**: Select the checkboxbox 
- **Content must contain**: Enter `UP`

1. Select **Save** to finish the configuration.

1. Use the following table to add other tests with these test names and URLs. Make sure the test name and app name are consistent.

   | Test name         | URL                                                                                                                    | Content must contain |
   |-------------------|------------------------------------------------------------------------------------------------------------------------|----------------------|
   | admin-server      | https://[your-Azure-Spring-Apps-instance-name]-admin-server.azuremicroservices.io/actuator/health/liveness             | UP                   |
   | customers-service | https://[your-Azure-Spring-Apps-instance-name]-api-gateway.azuremicroservices.io/api/customer/actuator/health/liveness | UP                   |
   | vets-service      | https://[your-Azure-Spring-Apps-instance-name]-api-gateway.azuremicroservices.io/api/vet/actuator/health/liveness      | UP                   |
   | visits-service    | https://[your-Azure-Spring-Apps-instance-name]-api-gateway.azuremicroservices.io/api/visit/actuator/health/liveness    | UP                   |

### 2.3. Monitor the dashboard

A dashboard is a cognitive awareness and communication tool that is designed to visually identify trends, patterns, anomalies, and help to make effective decisions. It can aggregate various metric charts, quick links, and other important information.

To create a custom dashboard, and pin various quickstart blades and metrics charts to the dashboard, use the following steps. If you choose to use the built-in dashboard of Application Insights created by the Azure Spring Apps, you can skip creating the dashboard and customizing the dashboard chart. For more information, see [Application Insights Overview dashboard](../../../azure-monitor/app/overview-dashboard.md).

1. From the Azure portal menu, select **Dashboard**. Your default view might already be set to dashboard.

1. Select **Create**, and then select **Custom** to create a custom dashboard.

> [!NOTE]
> You can also choose a wizard based on Application Insights to quickly create a default dashboard.

1. Enter a name for the dashboard, and then select **Save**.

   This action opens the **Tile Gallery** page, from which you can select the tiles, and an empty grid where you can arrange the tiles.

> [!NOTE]
> You can allow other users to view your dashboard using a shared dashboard. For more information, see [Share an Azure dashboard](../../../azure-portal/azure-portal-dashboard-share-access.md).

#### Basic monitoring

The most fundamental metrics for an application, especially microservices, are CPU usage, memory usage, liveness detection, and network traffic. These data are an important basis for evaluating application scalability.

Use the following steps to pin the various charts to the dashboard. 

##### Pin the "App CPU Usage" chart

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Metrics**, select the edit icon in the chart title, and then rename the chart title to `App CPU Usage`.

1. Select **Add metric**. For **Metric**, select the corresponding dropdown list to choose the **App CPU Usage** metric, and then select `Avg` for **Aggregation**.

1. Select **Apply splitting**. For **Values**, select the corresponding dropdown list to check the `App` box.

   :::image type="content" source="../../media/tutorial-applications-observability/chart-app-cpu-usage.png" alt-text="Screenshot of the Azure portal that shows the app cpu usage." lightbox="../../media/tutorial-applications-observability/chart-app-cpu-usage.png":::

1. Select **Save to dashboard** to open the dropdown list, then select **Pin to dashboard**. 

1. On the **Pin to dashboard** page, select the dashboard you created, and then select **Pin** to pin the quickstart chart to the dashboard.

##### Pin the "App Memory Usage" chart

For the **App Memory Usage** metric, save the **App Memory Usage** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-app-memory-usage.png" alt-text="Screenshot of the Azure portal that shows the app memory usage." lightbox="../../media/tutorial-applications-observability/chart-app-memory-usage.png":::

##### Pin the "App Network In" chart

For the **App Network In** metric, perform the following steps:

- **Add filter**: Select this option.
- **Property**: Select the corresponding dropdown list to choose `App` 
- **Operator**: Select `=`  
- **Values**: Select `admin-server` and `api-gateway`

1. Save the **App Network In Usage** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-app-network-in-usage.png" alt-text="Screenshot of the Azure portal that shows the app network in usage." lightbox="../../media/tutorial-applications-observability/chart-app-network-in-usage.png":::

##### Pin the "Availability" chart

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. On the left navigation menu, select **Metrics**, select the edit icon in the chart title, and then rename the chart title to `Availability`.

1. Select **Add metric**. 

1. For **Metric**, select the corresponding dropdown list to choose the `Availability` metric under the **Application Insights standard metrics** namespace, and then select `Avg` for **Aggregation**.

1. Select **Apply splitting**. For **Values**, select the corresponding dropdown list to check the `Test name` box, and then save the **Availability** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-availability.png" alt-text="Screenshot of the Azure portal that shows the availability chart." lightbox="../../media/tutorial-applications-observability/chart-availability.png":::

#### HTTP request monitoring

The indicators of the number of HTTP requests, response time, abnormal requests, and failed requests record the key data in the process of the application serving users. These data can help to find out whether the application business is providing services normally, which directly affect the service level of the application.

##### Pin the "Server exceptions and Dependency call failures" chart

For the **Server exception** and **Dependency call failures** metrics under the **Application Insights standard metrics** namespace, save the **Server exceptions and Dependency call failures** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-exceptions-and-failures.png" alt-text="Screenshot of the Azure portal that shows the exceptions and failures." lightbox="../../media/tutorial-applications-observability/chart-exceptions-and-failures.png":::

##### Pin the "Failed requests" chart

For the **Failed requests** metric under the **Application Insights standard metrics** namespace, save the **Failed requests** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-failed-requests.png" alt-text="Screenshot of the Azure portal that shows the failed requests." lightbox="../../media/tutorial-applications-observability/chart-failed-requests.png":::

##### Pin the "Request count" chart

For the **Server requests** metric under the **Application Insights standard metrics** namespace, add a filter to filter the **Cloud role name** with **api-gateway** and **admin-server**, apply splitting for **Values** with **Cloud role name**, and then save the **Request count** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-request-count.png" alt-text="Screenshot of the Azure portal that shows the server requests." lightbox="../../media/tutorial-applications-observability/chart-request-count.png":::

##### Pin the "Response time" chart

For the **Server response time** metric under the **Application Insights standard metrics** namespace, add a filter to filter the **Cloud role name** with **api-gateway**, and then save the **Response time** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-response-time.png" alt-text="Screenshot of the Azure portal that shows the response time." lightbox="../../media/tutorial-applications-observability/chart-response-time.png":::

#### Database performance monitoring

Database performance is the cornerstone of normal service for all applications. Actually, there are many application performance downgrades caused by the slow database or exhausted database connection pool. It's necessary to ensure that the performance at the database level meets expectations, otherwise, it causes chain issues.

#### Pin the "Active MySQL connections" chart

For the **hikaricp_connection_active** metric under the **Log-based metrics** namespace, save the **Active MySQL connections** chart to the dashboard.

:::image type="content" source="../../media/tutorial-applications-observability/chart-connection-active.png" alt-text="Screenshot of the Azure portal that shows the active connection." lightbox="../../media/tutorial-applications-observability/chart-connection-active.png":::

#### Pin content from a resource page

Pin some commonly used links into the dashboard, which lets you quickly open the operation page on Azure or other resource pages, and improves efficiency.

To pin the common blades of Azure portal to the dashboard, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Application Insights** to go to the Application Insights overview page.

1. On the left navigation menu, select **Application map**, and select the **Pin blade to dashboard** icon in each page header.

1. On the **Pin to dashboard** page, select the dashboard you created, and then select **Pin** to pin the quickstart chart to the dashboard.

1. Repeat these steps to pin the **Live metrics**, **Failures**, and **Performance** blades to your dashboard as needed.

#### View the dashboard

To view the dashboard, go to your private `PetClinic` dashboard page to edit the tiles in the dashboard for easy monitoring.

:::image type="content" source="../../media/tutorial-applications-observability/dashboard-page.png" alt-text="Screenshot of the Azure portal that shows the dashboard." lightbox="../../media/tutorial-applications-observability/dashboard-page.png":::

## 3. Manage alerts

Alerts help you detect and address issues before users notice them by proactively notifying you when the metrics or logs indicate there might be a problem with your infrastructure or application. 

This section explains how to set up action groups and alert rules to monitor your production application. The alert rules bind metric patterns with the action groups on the target resource. When the metric pattern matches the condition, then the alert rule activates and executes the associated set of actions.

### 3.1. Set up an action group

To set up an action group, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Alert**, select **Action groups** to go to the action groups list page, and then select **Create** to create an action group.

1. On the **Create action group** page, select the subscription and resource group you want to cover. Enter the following information:

- **Action group name**: Enter `email-notifacation`
- **Short name**: Enter `email`
- **Region**: Select the region you want to use

1. Navigate to the **Notification** tab on the **Create action group** page. For **Notification type**, select `Email/SMS message/Push/Voice`, for **Name**, enter `email-support`.

1. On the **Email/SMS message/Push/Voice** page, check the **Email** box, enter your production email address for **Email**, and then select **OK** to finish the configuration. You can also add other notification types if you want, such as SMS, Azure mobile app notification, Voice, etc.

1. Select **Review and Create** to review your selections. Select **Create** to create the action group.

### 3.2. Set up an alert rule

To set up an alert rule, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Alert**, select **Alert rules** to go to the Alert rules list page, and then select **Create** to create an alert rule.

1. On the **Create an alert rule** page, for **signal name**, select the dropdown list, and then select **See all signals**. 

1. In the **Metrics** area, select `App CPU Usage`, and then select **Apply**.

1. For the alert logic section, select **Static** for threshold type, select **Average** for **Aggregation type**, select `Greater than` for **Operator**, and then enter `90` for **Threshold value**. 

1. For the **Split by dimensions** section, select the dropdown list to choose `App` for **Dimension name**, use the default `=` for **Operator**, and then select the dropdown list to choose `Select all` for **Dimension values**. Keep the default value for **When to evaluate** section.

1. Navigate to the **Actions** tab on the **Create an alert rule** page, select **Select action groups**. On the **Select action groups** page, search your email action group name, such as `email-notifacation`, check the corresponding action group, and then select **Select** to finish the configuration.

1. Navigate to the **Details** tab on the **Create an alert rule** page, and enter `app-cpu-high-alert` for **Alert rule name**.

1. Select **Review and Create** to review your selections. Select **Create** to create the alert rule.

1. To create an alert rule for `App Memory Usage` metric signal, use the following inputs:

   - **Signal name**: `App Memory Usage`
   - **Threshold value**: `90`
   - **Dimension name**: `App`
   - **Dimension values**: Select all
   - **Action group name**: `email-notification`
   - **Alert rule name**: `app-memory-high-alert`

1. To create an alert rule for `App Network In` metric signal, use the following inputs:

   - **Signal name**: `App Network In`
   - **Unit**: `GB`
   - **Threshold value**: `1`
   - **Dimension name**: `App`
   - **Dimension values**: `api-gateway`
   - **Action group name**: `email-notification`
   - **Alert rule name**: `network-in-high-alert`

1. After you've created all the alert rules, you can view the alert rules list.

### 3.3. Pin alerts to the dashboard

To pin the quickstart chart to the dashboard, use the following steps:

1. Go to the Azure Spring Apps instance overview page.

1. On the left navigation menu, select **Alert**, and then select the **Pin blade to dashboard** icon.
