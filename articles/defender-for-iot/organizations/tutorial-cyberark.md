---
title: Integrate CyberArk with Azure Defender for IoT
description: In this tutorial, you will learn how to integrate Azure Defender for IoT with CyberArk.
author: ElazarK
ms.author: v-ekrieg
ms.topic: tutorial
ms.date: 09/30/2021
ms.custom: template-tutorial
---

# Tutorial: Integrate CyberArk with Azure Defender for IoT

This tutorial will help you learn how to integrate, and use CyberArk with Azure Defender for IoT.

Defender for IoT delivers ICS, and IIoT cybersecurity platform with ICS-aware threat analytics, and machine learning.

Threat actors are using compromised remote access credentials to access critical infrastructure networks via remote desktop and VPN connections. By using trusted connections, this approach easily bypasses any OT perimeter security. Credentials are typically stolen from privileged users,  such as control engineers and partner maintenance personnel, who require remote access to perform daily tasks.

The Defender for IoT integration along with with CyberARK allows you to:

- Reduce OT risks from unauthorized remote access

- Provide continuous monitoring, and privileged access security for OT

- Enhance incident response, threat hunting, and threat modeling

### Real time alerting

Whenever the Defender for IoT platform identifies remote sessions that have not been authorized by PSM, it will issue an `Unauthorized Remote Session` alert as shown below. To facilitate immediate investigation, the alert also shows the IP addresses and names of the source and destination devices.

:::image type="content" source="media/tutorial-cyberark/unauthorized.png" alt-text="The Unauthorized Remote Session alert.":::

### Event timeline

Whenever PSM authorizes a remote connection, it will be documented and visible in the Defender for IoT **Event Log** page, which shows a timeline of all alerts and notifications. This acts as an extra audit trail, as seen below:

:::image type="content" source="media/tutorial-cyberark/event.png" alt-text="A view of the Event Log screen.":::

### Auditing & forensics

Administrators can also audit and investigate remote access sessions by querying the Defender for IoT platform via its built-in data mining interface. This can be used to identify all remote access connections that have occurred including forensic details such as from, or to devices, protocols (RDP or SSH), source, and destination users, time-stamps, and whether the sessions were authorized using PSM.

:::image type="content" source="media/tutorial-cyberark/data-mining.png" alt-text="A view of the data mining interface.":::

### Integration system requirements

This section describes integration system requirements:

- **Defender for IoT Requirements**
- **CyberARK Requirements**
  - CyberARK version 2.0.
- **Network Requirements**
  - Verify that the Defender for IoT appliance has access to TBD.
  - Verify that you have CLI access to all Defender for IoT appliances in your enterprise.

## How it works

The Defender for IoT appliance is connected to the OT network via a SPAN port (mirror port) on network devices such as switches and routers. A network TAP can also be used. This is achieved via a one-way (inbound) connection to the dedicated network interfaces on the Defender for IoT appliance.

A dedicated network interface is also provided in the Defender for IoT appliance for centralized management and API access. This interface is also used for communicating with the CyberArk PSM solution.

The CyberArk PSM solution is deployed in the data center of the organization to manage privileged users and secure remote access connections.

:::image type="content" source="media/tutorial-cyberark/architecture.png" alt-text="The CyberArk PSM solution deployment":::

The integration between the Defender for IoT platform and CyberArk PSM is performed via syslog messages. These messages are sent by the PSM solution to the Defender for IoT platform, notifying Defender for IoT of any remote sessions or verification failures.

Once the Defender for IoT platform receives these messages from PSM, it correlates them with the data it sees in the network, thus validating that any remote access connections to the network were generated by the PSM solution and not by a rogue or unauthorized user.

## CyberArk setup

This section describes how to:

- TBD

### Set up communication with CyberArk

TBD

### Define the PSM configuration

TBD

To configure PSM:

1. Configure syslog forwarding:

   - Open `c:\Program Files\PrivateArk\Server\dbparam.xml` file

   - Add the following parameters:

   ```bash
   [SYSLOG]

   UseLegacySyslogFormat=Yes

   SyslogTranslatorFile=Syslog\CyberX.xsl

   SyslogServerIP=<CyberX Server IP>

   SyslogServerProtocol=UDP

   SyslogMessageCodeFilter=319,320,295,378,380
   ```

    - Save the file and close it
1. Place the Defender for IoT syslog configuration file (CyberX.xsl) in c:\Program Files\PrivateArk\Server\Syslog\CyberX.xsl

1. Restart the vault server:

   - Open the **Server Central Administration** (Icon: PrivateArk Server).

   :::image type="content" source="media/tutorial-cyberark/server.png" alt-text="The server central administration.":::

   - Select the **Stop Traffic Light** (Server Stop).

   - Select the **Start Traffic Light** (Server Start).

## Defender for IoT platform configuration

By default, the Syslog Server listens to the IP address of the system using port 514 UDP. This default can be updated.

To configure the Defender for IoT platform:

### Starting the syslog server

- In Defender for IoT console, navigate to the **System Settings** screen.

- Toggle **On** the Syslog Server.

:::image type="content" source="media/tutorial-cyberark/toggle.png" alt-text="The server status toggle.":::

### Changing the port

If you want to change the port, sign in to the system via the CLI, and navigate to `/var/cyberx/properties/syslog.properties`, and change the following: `listener: 514/udp`.

### Halting the Integration

To stop the integration:

- In Defender for IoT console, navigate to the **System Settings** screen.

- Toggle **Off** the Syslog Server.

:::image type="content" source="media/tutorial-cyberark/toggle.png" alt-text="A view of th Server status.":::

## Set up the Defender for IoT appliances

This section describes how to set up Defender for IoT appliances to communicate with pxGrid. The configuration should be carried out on all Defender for IoT appliances that will inject data to Cisco ISE.

To set up appliances:

1. TBD

## View and manage detections in XX

## Troubleshooting and logs

Logs can be found in:

- `/var/cyberx/logs/pxgrid.log`

- `/var/cyberx/logs/core.log`

### From other resources

#### Phase 1 - Integration for user activity via Syslog

**Use case** - Defender for IoT sees all real-time communication in the network, thus can validate that every remote access activity is used only by CyberArk, in case Defender for IoT sees a remote access connection that was not initiated from CyberArk it can alert it to the SOC for further investigation.

**Integration Details** - CyberArk's product (PSM) will forward XSense syslog messages, notifying about remote sessions or verification failures.

**Integration Status** - Done. Verified during the integration checks

#### Phase 2 - Accessing recorded sessions from the recordings vault

**Use case** - Defender for IoT will suggest the customer view recorded session to devices in the network, retrieved from CyberArk vault.

**Integration Details** - Defender for IoT will use PACLI (CyberArk tool for communicating with their product) to gather the recording files from the CyberArk vault.

**Integration Status:** - All technical information has been gathered, in development stages.

#### Phase 3 - Initiating connections

Krumer: Add AIM (Application Identity Manager) integration to gather credentials for PLCs and query device so all credentials are in the CyberArk

**Use Case** - A redirect from Defender for IoT to CyberArk's platform to initiate a secured remote session.

**Integration Details** â€“ Yet to be determined.

**Integration Status:** - Require additional information from CyberArk product team.
