---
title: OT monitoring management API reference - Microsoft Defender for IoT
description: Learn about the REST APIs supported for Microsoft Defender for IoT OT monitoring on-premises management consoles.
ms.date: 05/25/2022
ms.topic: reference
---

# On-premises management console API reference

This article lists the APIs supported for Defender for IoT OT on-premises monitoring consoles.


## set_password (Change password)

Use this API to let users change their own passwords. All Defender for IoT user roles can work with the API.

You don't need a Defender for IoT access token to use this API.

**URI**: `/external/authentication/set_password`

**Method**: POST

# [Request](#tab/request-set-password)

**Type**: JSON

**Request example**:

```rest
request:

{

    "username": "test",

    "password": "Test12345\!",

    "new_password": "Test54321\!"

}

```

# [Response](#tab/response-set-password)

**Type**: JSON


Message string with the operation status details:

- **Success – msg**: Password has been replaced

- **Failure – error**: User authentication failure

- **Failure – error**: Password does not match security policy

**Response example**:

```rest
response:

{

    "error": {

        "userDisplayErrorMessage": "User authentication failure"

    }

}

```

**Device fields**:

| **Name** | **Type** | **Nullable** |
|--|--|--|
| **username** | String | No |
| **password** | String | No |
| **new_password** | String | No |

# [Curl command](#tab/set-password-curl)

**Type**: POST

**API**:

```
curl -k -d '{"username": "<USER_NAME>","password": "<CURRENT_PASSWORD>","new_password": "<NEW_PASSWORD>"}' -H 'Content-Type: application/json'  https://<IP_ADDRESS>/external/authentication/set_password
```

**Example**:

```rest
curl -k -d '{"username": "myUser","password": "1234@abcd","new_password": "abcd@1234"}' -H 'Content-Type: application/json'  https://127.0.0.1/external/authentication/set_password
```
---

## set_password_by_admin (User password update by system admin)

Use this API to let system administrators change passwords for specified users. Defender for IoT admin user roles can work with the API.

You don't need a Defender for IoT access token to use this API.

**URI**: /external/authentication/set_password_by_admin

### POST

# [Request](#tab/set-password-by-admin-request)

**Type**: JSON

**Request example**:

```rest
request:

{

    "username": "test",

    "password": "Test12345\!",

    "new_password": "Test54321\!"

}
```

# [Response](#tab/set-password-by-admin-response)

**Type**: JSON

Message string with the operation status details:

- **Success – msg**: Password has been replaced

- **Failure – error**: User authentication failure

- **Failure – error**: User does not exist

- **Failure – error**: Password doesn't match security policy

- **Failure – error**: User does not have the permissions to change password

**Response example**

```rest
response:

{

    "error": {

        "userDisplayErrorMessage": "The user 'test_user' doesn't exist",

        "internalSystemErrorMessage": "The user 'yoavfe' doesn't exist"

    }

}

```

**Device fields**

| **Name** | **Type** | **Nullable** |
|--|--|--|
| **admin_username** | String | No |
| **admin_password** | String | No |
| **username** | String | No |
| **new_password** | String | No |

# [Curl command](#tab/set-password-by-admin-curl)

**Type**: POST

**API**:

```rest
curl -k -d '{"admin_username":"<ADMIN_USERNAME>","admin_password":"<ADMIN_PASSWORD>","username": "<USER_NAME>","new_password": "<NEW_PASSWORD>"}' -H 'Content-Type: application/json'  https://<IP_ADDRESS>/external/authentication/set_password_by_admin
```

**Example**:

```rest
curl -k -d '{"admin_user":"adminUser","admin_password": "1234@abcd","username": "myUser","new_password": "abcd@1234"}' -H 'Content-Type: application/json'  https://127.0.0.1/external/authentication/set_password_by_admin
```
---

## QRadar alerts

<!--why is this here? its not an api-->

QRadar integration helps you to identify and action alerts generated by Defender for IoT. QRadar receives the data from Defender for IoT, and then contacts the public API on-premises management console.

To send the data discovered by Defender for IoT to QRadar, define a forwarding rule in the Defender for IoT system and select the **Remote support alert handling** option. With this option selected, the following additional fields appear in QRadar:

- **UUID**: Unique alert identifier, such as 1-1555245116250.

- **Site**: The site where the alert was discovered.

- **Zone**: The zone where the alert was discovered.

For example:

```rest
<9>May 5 12:29:23 sensor_Agent LEEF:1.0|CyberX|CyberX platform|2.5.0|CyberX platform Alert|devTime=May 05 2019 15:28:54 devTimeFormat=MMM dd yyyy HH:mm:ss sev=2 cat=XSense Alerts title=Device is Suspected to be Disconnected (Unresponsive) score=81 reporter=192.168.219.50 rta=0 alertId=6 engine=Operational senderName=sensor Agent UUID=5-1557059334000 site=Site zone=Zone actions=handle dst=192.168.2.2 dstName=192.168.2.2 msg=Device 192.168.2.2 is suspected to be disconnected (unresponsive).
```

## devices (Retrieve device information per sensor)

Use this API to request a list of all devices that a Defender for IoT sensor has detected.

**URI**: `/api/v1/devices`

### GET

# [Request](#tab/devices-request)

**Query parameters**:


|Name  |Description  |Examples  |
|---------|---------|---------|
|**authorized**     | To filter only authorized and unauthorized devices.        |    `/api/v1/devices?authorized=true`<br>  `/api/v1/devices?authorized=false`
       |

# [Response](#tab/devices-response)

**Type**: JSON

Array of JSON objects that represent devices.

**Device fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **id** | Numeric | No | - |
| **ipAddresses** | JSON array | Yes | IP addresses (can be more than one address in case of internet addresses or a device with dual NICs) |
| **name** | String | No | - |
| **type** | String | No | Unknown, Engineering Station, PLC, HMI, Historian, Domain Controller, DB Server, Wireless Access Point, Router, Switch, Server, Workstation, IP Camera, Printer, Firewall, Terminal station, VPN Gateway, Internet, or Multicast and Broadcast |
| **macAddresses** | JSON array | Yes | MAC addresses (can be more than one address in case of a device with dual NICs) |
| **operatingSystem** | String | Yes | - |
| **engineeringStation** | Boolean | No | True or false |
| **scanner** | Boolean | No | True or false |
| **authorized** | Boolean | No | True or false |
| **vendor** | String | Yes | - |
| **protocols** | JSON array | Yes | Protocol object |
| **firmware** | JSON array | Yes | Firmware object |

**Protocol fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **Name** | String | No |  |
| **Addresses** | JSON array | Yes | `Master`, or numeric values |

**Firmware fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **serial** | String | No | N/A, or the actual value |
| **model** | String | No | N/A, or the actual value |
| **firmwareVersion** | Double | No | N/A, or the actual value |
| **additionalData** | String | No | N/A, or the actual value |
| **moduleAddress** | String | No | N/A, or the actual value |
| **rack** | String | No | N/A, or the actual value |
| **slot** | String | No | N/A, or the actual value |
| **address** | String | No | N/A, or the actual value |

**Response example**

```rest
[
    {
    "vendor": null,
    "name": "10.4.14.102",
    "firmware": [
        {
            "slot": "N/A",
            "additionalData": "N/A",
            "moduleAddress": "Network: Local network (0), Node: 0, Unit: CPU (0x0)",
            "rack": "N/A",
            "address": "10.4.14.102",
            "model": "AAAAAAAAAA",
            "serial": "N/A",
            "firmwareVersion": "20.55"
        },
        {
            "slot": "N/A",
            "additionalData": "N/A",
            "moduleAddress": "Network: Local network (0), Node: 0, Unit: Unknown (0x3)",
            "rack": "N/A",
            "address": "10.4.14.102",
            "model": "AAAAAAAAAAAAAAAAAAAA",
            "serial": "N/A",
            "firmwareVersion": "20.55"
        },
        {
            "slot": "N/A",
            "additionalData": "N/A",
            "moduleAddress": "Network: Local network (0), Node: 3, Unit: CPU (0x0)",
            "rack": "N/A",
            "address": "10.4.14.102",
            "model": "AAAAAAAAAAAAAAAAAAAA",
            "serial": "N/A",
            "firmwareVersion": "20.55"
        },
        {
            "slot": "N/A",
            "additionalData": "N/A",
            "moduleAddress": "Network: 3, Node: 0, Unit: CPU (0x0)",
            "rack": "N/A",
            "address": "10.4.14.102",
            "model": "AAAAAAAAAAAAAAAAAAAA",
            "serial": "N/A",
            "firmwareVersion": "20.55"
        }
    ],
    "id": 79,
    "macAddresses": null,
    "authorized": true,
    "ipAddresses": [
        "10.4.14.102"
    ],
    "engineeringStation": false,
    "type": "PLC",
    "operatingSystem": null,
    "protocols": [
        {
            "addresses": [],
            "id": 62,
            "name": "Omron FINS"
        }
    ],
    "scanner": false
}
]
```

# [Curl command](#tab/devices-curl)

**Type**: GET

**APIs**:


```rest
curl -k -H "Authorization: <AUTH_TOKEN>" https://<IP_ADDRESS>/api/v1/devices
```

**Example**:

```rest
curl -k -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" https://127.0.0.1/api/v1/devices?authorized=true
```
---

## validation (Authenticate user credentials)

Use this API to validate user credentials. All Defender for IoT user roles can work with the API. You don't need a Defender for IoT access token to use this API.

**URI**: `/external/authentication/validation`

### POST

# [Request](#tab/validation-request)

**Type**: JSON

**Request example**:

```rest
request:

{

    "username": "test",

    "password": "Test12345\!"

}
```

# [Response](#tab/validation-response)

**Type**: JSON

Message string with the operation status details:

- **Success – msg**: Authentication succeeded

- **Failure – error**: Credentials Validation Failed

**Device fields**:

| **Name** | **Type** | **Nullable** |
|--|--|--|
| **username** | String | No |
| **password** | String | No |

**Response example**:

```rest
response:

{

    "msg": "Authentication succeeded."

}
```

# [Curl command](#tab/validation-curl)

**Type**: POST

**APIs**:

```rest
curl -k -d '{"username":"<USER_NAME>","password":"PASSWORD"}' 'https://<IP_ADDRESS>/external/authentication/validation'
```

**Example**:

```rest
curl -k -d '{"username":"myUser","password":"1234@abcd"}' 'https://127.0.0.1/external/authentication/validation
```
---
## devices (Retrieve all device information)


This API requests a list of all devices detected by Defender for IoT sensors that are connected to an on-premises management console.

**URI**: `/external/v1/devices`

### GET

# [Response](#tab/devices-get-response)

**Type**: JSON

Array of JSON objects that represent devices.


|Name  |Description  | Example |
|---------|---------|---------|
|**authorized**     |  To filter only authorized and unauthorized devices.       | `/external/v1/devices?authorized=true` <br><br>`/external/v1/devices?authorized=false`|
|**siteId**     |  To filter only devices related to specific sites.       | `/external/v1/devices?siteId=1,2`|
|**zoneId**     |To filter only devices related to specific zones. <sup>[1](#1)</sup>         | `/external/v1/devices?zoneId=5,6` |
|**sensorId**     | To filter only devices detected by specific sensors. <sup>[1](#1)</sup>        | `/external/v1/devices?sensorId=8`|

> [!NOTE]
> <a id="1">1</a> You might not have the site and zone ID. If this is the case, query all devices to retrieve the site and zone ID.*
>

**Device fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **sensorId** | Numeric | No | - |
| **zoneId** | Numeric | Yes | - |
| **siteId** | Numeric | Yes | - |
| **ipAddresses** | JSON array | Yes | IP addresses (can be more than one address in case of internet addresses or a device with dual NICs) |
| **name** | String | No | - |
| **type** | String | No | Unknown, Engineering Station, PLC, HMI, Historian, Domain Controller, DB Server, Wireless Access Point, Router, Switch, Server, Workstation, IP Camera, Printer, Firewall, Terminal station, VPN Gateway, Internet, or Multicast and Broadcast |
| **macAddresses** | JSON array | Yes | MAC addresses (can be more than one address in case of a device with dual NICs) |
| **operatingSystem** | String | Yes | - |
| **engineeringStation** | Boolean | No | True or false |
| **scanner** | Boolean | No | True or false |
| **authorized** | Boolean | No | True or false |
| **vendor** | String | Yes | - |
| **Protocols** | JSON array | Yes | Protocol object |
| **firmware** | JSON array | Yes | Firmware object |

**Protocol fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **Name** | String | No | - |
| **Addresses** | JSON array | Yes | `Master`, or numeric values |

**Firmware fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **serial** | String | No | N/A, or the actual value |
| **model** | String | No | N/A, or the actual value |
| **firmwareVersion** | Double | No | N/A, or the actual value |
| **additionalData** | String | No | N/A, or the actual value |
| **moduleAddress** | String | No | N/A, or the actual value |
| **rack** | String | No | N/A, or the actual value |
| **slot** | String | No | N/A, or the actual value |
| **address** | String | No | N/A, or the actual value |

**Response example**:

```rest
[

    {

    "sensorId": 7,

    "zoneId": 1,

    "siteId": 1,

    "vendor": null,

    "name": "10.4.14.102",

    "firmware": [

    {

        "slot": "N/A",

        "additionalData": "N/A",

        "moduleAddress": "Network: Local network (0), Node: 0, Unit: CPU (0x0)",

        "rack": "N/A",

        "address": "10.4.14.102",

        "model": "AAAAAAAAAA",

        "serial": "N/A",

        "firmwareVersion": "20.55"

    },

    {

        "slot": "N/A",

        "additionalData": "N/A",

        "moduleAddress": "Network: Local network (0), Node: 0, Unit: Unknown (0x3)",

        "rack": "N/A",

        "address": "10.4.14.102",

        "model": "AAAAAAAAAAAAAAAAAAAA",

        "serial": "N/A",

        "firmwareVersion": "20.55"

    },

    {

        "slot": "N/A",

        "additionalData": "N/A",

        "moduleAddress": "Network: Local network (0), Node: 3, Unit: CPU (0x0)",

        "rack": "N/A",

        "address": "10.4.14.102",

        "model": "AAAAAAAAAAAAAAAAAAAA",

        "serial": "N/A",

        "firmwareVersion": "20.55"

    },

    {

        "slot": "N/A",

        "additionalData": "N/A",

        "moduleAddress": "Network: 3, Node: 0, Unit: CPU (0x0)",

        "rack": "N/A",

        "address": "10.4.14.102",

        "model": "AAAAAAAAAAAAAAAAAAAA",

        "serial": "N/A",

        "firmwareVersion": "20.55"

    }

],

"id": 79,

"macAddresses": null,

"authorized": true,

"ipAddresses": [

    "10.4.14.102"

],

"engineeringStation": false,

"type": "PLC",

"operatingSystem": null,

"protocols": [

    {

        "addresses": [],

        "id": 62,

        "name": "Omron FINS"

    }

],

"scanner": false

}

]
```

# [Curl command](#tab/devices-get-curl)

**Type**: GET

**APIs**:

```rest
curl -k -H "Authorization: <AUTH_TOKEN>" 'https://<>IP_ADDRESS>/external/v1/devices?siteId=&zoneId=&sensorId=&authorized='
```

**Example**:

```rest
curl -k -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" 'https://127.0.0.1/external/v1/devices?siteId=1&zoneId=2&sensorId=5&authorized=true'
```

---

## alerts (Retrieve alert information)


Use this API to retrieve all or filtered alerts from an on-premises management console.

**URI**:  `/external/v1/alerts`

### GET


# [Request](#tab/alerts-request)

**Query parameters**:


|Name  |Description  |Example  |
|---------|---------|---------|
|**state**     |To filter only handled and unhandled alerts.         |   `/api/v1/alerts?state=handled`      |
|**fromTime**     | To filter alerts created from a specific time (in milliseconds, UTC).        |   `/api/v1/alerts?fromTime=<epoch>`      |
|**toTime**     |  To filter alerts created only before a specific time (in milliseconds, UTC).       |   `/api/v1/alerts?toTime=<epoch>`      |
|**siteId**     |  The site on which the alert was discovered.       |         |
|**zoneId**     |  The zone on which the alert was discovered.       |         |
|**sensor**     |    The sensor on which the alert was discovered.     |         |

> [!NOTE]
> You might not have the site and zone ID. If this is the case, query all devices to retrieve the site and zone ID.

**Alert fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **ID** | Numeric | No | - |
| **time** | Numeric | No | Epoch (UTC) |
| **title** | String | No | - |
| **message** | String | No | - |
| **severity** | String | No | Warning, Minor, Major, or Critical |
| **engine** | String | No | Protocol Violation, Policy Violation, Malware, Anomaly, or Operational |
| **sourceDevice** | Numeric | Yes | Device ID |
| **destinationDevice** | Numeric | Yes | Device ID |
| **sourceDeviceAddress** | Numeric | Yes | IP, MAC |
| **destinationDeviceAddress** | Numeric | Yes | IP, MAC |
| **remediationSteps** | String | Yes | Remediation steps shown in alert|
| **sensorName** | String | Yes | Name of sensor defined by user |
|**zoneName** | String | Yes | Name of zone associated with sensor|
| **siteName** | String | Yes | Name of site associated with sensor |
| **additionalInformation** | Additional information object | Yes | - |

> [!NOTE]
> /api/v2/ is needed for the following information:
>
> - sourceDeviceAddress
> - destinationDeviceAddress
> - remediationSteps
> - sensorName
> - zoneName
> - siteName
>

**Additional information fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **description** | String | No | - |
| **information** | JSON array | No | String |

# [Response](#tab/devices-response)

**Response example**

```rest
[
    {
        "engine": "Operational",
        "handled": false,
        "title": "Traffic Detected on sensor Interface",
        "additionalInformation": null,
        "sourceDevice": 0,
        "zoneId": 1,
        "siteId": 1,
        "time": 1594808245000,
        "sensorId": 1,
        "message": "The sensor resumed detecting network traffic on ens224.",
        "destinationDevice": 0,
        "id": 1,
        "severity": "Warning"
    },
    {
        "engine": "Anomaly",
        "handled": false,
        "title": "Address Scan Detected",
        "additionalInformation": null,
        "sourceDevice": 4,
        "zoneId": 1,
        "siteId": 1,
        "time": 1594808260000,
        "sensorId": 1,
        "message": "Address scan detected.\nScanning address: 10.10.10.22\nScanned subnet: 10.11.0.0/16\nScanned addresses: 10.11.1.1, 10.11.20.1, 10.11.20.10, 10.11.20.100, 10.11.20.2, 10.11.20.3, 10.11.20.4, 10.11.20.5, 10.11.20.6, 10.11.20.7...\nIt is recommended to notify the security officer of the incident.",
        "destinationDevice": 0,
        "id": 2,
        "severity": "Critical"
    },
    {
        "engine": "Operational",
        "handled": false,
        "title": "Suspicion of Unresponsive MODBUS Device",
        "additionalInformation": null,
        "sourceDevice": 194,
        "zoneId": 1,
        "siteId": 1,
        "time": 1594808285000,
        "sensorId": 1,
        "message": "Outstation device 10.13.10.1 (Protocol Address 53) seems to be unresponsive to MODBUS requests.",
        "destinationDevice": 0,
        "id": 3,
        "severity": "Minor"
    }
]
```
# [Curl command](#tab/devices-curl)

**Type**: GET

**API**:

```rest
curl -k -H "Authorization: <AUTH_TOKEN>" 'https://<>IP_ADDRESS>/external/v1/alerts?state=&zoneId=&fromTime=&toTime=&siteId=&sensor='
```

**Example**:

```rest
curl -k -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" 'https://127.0.0.1/external/v1/alerts?state=unhandled&zoneId=1&fromTime=0&toTime=1594551777000&siteId=1&sensor=1'
```

---

## UUID (Manage alerts based on the UUID)

Use this API to take specified action on a specific alert detected by Defender for IoT.

**URI**: `/external/v1/alerts/<UUID>`

### PUT

# [Request](#tab/uuid-request)

**Type**: JSON

JSON object that represents the action to perform on the alert that contains the UUID.

**Action fields**

| Name | Type | Nullable | List of values |
|--|--|--|--|
| **action** | String | No | handle or handleAndLearn |

**Request example**

```rest
{
    "action": "handle"
}

```
# [Response](#tab/uuid-response)

**Type**: JSON


Array of JSON objects that represent devices.

**Response fields**:

| Name | Type | Nullable | Description |
|--|--|--|--|
| **content / error** | String | No | If the request is successful, the content property appears. Otherwise, the error property appears. |

**Possible content values**:

| Status code | Content value | Description |
|--|--|--|
| 200 | Alert update request finished successfully. | The update request finished successfully. No comments. |
| 200 | Alert was already handled (**handle**). | The alert was already handled when a handle request for the alert was received.<br />The alert remains **handled**. |
| 200 | Alert was already handled and learned (**handleAndLearn**). | The alert was already handled and learned when a request to **handleAndLearn** was received.<br />The alert remains in the **handledAndLearn** status. |
| 200 | Alert was already handled (**handled**).<br />Handle and learn (**handleAndLearn**) was performed on the alert. | The alert was already handled when a request to **handleAndLearn** was received.<br />The alert becomes **handleAndLearn**. |
| 200 | Alert was already handled and learned (**handleAndLearn**). Ignored handle request. | The alert was already **handleAndLearn** when a request to handle the alert was received. The alert stays **handleAndLearn**. |
| 500 | Invalid action. | The action that was sent is not a valid action to perform on the alert. |
| 500 | Unexpected error occurred. | An unexpected error occurred. To resolve the issue, contact Technical Support. |
| 500 | Couldn't execute request because no alert was found for this UUID. | The specified alert UUID was not found in the system. |

**Response example**: Successful

```rest
{
    "content": "Alert update request finished successfully"
}
```

**Response example**: Unsuccessful

```rest
{
    "error": "Invalid action"
}
```

# [Curl command](#tab/uuid-curl)

**Type**: PUT

**APIs**:

```rest
curl -k -X PUT -d '{"action": "<ACTION>"}' -H "Authorization: <AUTH_TOKEN>" https://<IP_ADDRESS>/external/v1/alerts/<UUID>
```

**Example**:

```rest
curl -k -X PUT -d '{"action": "handle"}' -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" https://127.0.0.1/external/v1/alerts/1-1594550943000
```
---
## maintenanceWindow (Create alert exclusions)

**URI**: `/external/v1/maintenanceWindow`

### POST

Define conditions under which alerts won't be sent. For example, define and update stop and start times, devices or subnets that should be excluded when triggering alerts, or Defender for IoT engines that should be excluded. For example, during a maintenance window, you might want to stop alert delivery of all alerts, except for malware alerts on critical devices.

The APIs that you define here appear in the on-premises management console's Alert Exclusions window as a read-only exclusion rule.

> [!IMPORTANT]
> This API is supported for maintenance purposes only and is not meant to be used instead of [alert exclusion rules](/azure/defender-for-iot/organizations/how-to-work-with-alerts-on-premises-management-console#create-alert-exclusion-rules). Use this API for one-time maintenance operations only.

# [Request](#tab/maintenanceWindow-request-post)

**Query parameters**:

|Name  |Description |
|---------|---------|
|**ticketId**     | Defines the maintenance ticket ID in the user's systems.        |
|**ttl**     |  Required. Defines the TTL (time to live), which is the duration of the maintenance window in minutes. After the period of time that this parameter defines, the system automatically starts sending alerts.       |
|**engines**     |  Defines from which security engine to suppress alerts during the maintenance process:<br><br>    - ANOMALY<br>    - MALWARE<br>    - OPERATIONAL<br>    - POLICY_VIOLATION<br>    - PROTOCOL_VIOLATION       |
|**sensorIds**     | Defines from which Defender for IoT sensor to suppress alerts during the maintenance process. It's the same ID retrieved from /api/v1/appliances (GET).        |
|**subnets**     |  Defines from which subnet to suppress alerts during the maintenance process. The subnet is sent in the following format: 192.168.0.0/16.       |

# [Response](#tab/maintenanceWindow-response-post)


|Code  |Description|
|---------|---------|
|**201 (Created)**     |  The action was successfully completed.       |
|**400 (Bad Request)**     |Appears in the following cases: <br><br>   - The **ttl** parameter is not numeric or not positive.<br>   - The **subnets** parameter was defined using a wrong format.<br>   - The **ticketId** parameter is missing.<br>   - The **engine** parameter does not match the existing security engines.         |
|**404 (Not Found)**     | One of the sensors doesn't exist.        |
|**409 (Conflict)**     | The ticket ID is linked to another open maintenance window.        |
|**500 (Internal Server Error)**     |   Any other unexpected error.      |

> [!NOTE]
> Make sure that the ticket ID is not linked to an existing open window. The following exclusion rule is generated: `Maintenance-{token name}-{ticket ID}`.

# [Curl command](#tab/maintenanceWindow-post-curl)

**Type**: POST

**API**:

```rest
curl -k -X POST -d '{"ticketId": "<TICKET_ID>",ttl": <TIME_TO_LIVE>,"engines": [<ENGINE1, ENGINE2...ENGINEn>],"sensorIds": [<SENSOR_ID1, SENSOR_ID2...SENSOR_IDn>],"subnets": [<SUBNET1, SUBNET2....SUBNETn>]}' -H "Authorization: <AUTH_TOKEN>" https://127.0.0.1/external/v1/maintenanceWindow
```

**Example**:

```rest
curl -k -X POST -d '{"ticketId": "a5fe99c-d914-4bda-9332-307384fe40bf","ttl": "20","engines": ["ANOMALY"],"sensorIds": ["5","3"],"subnets": ["10.0.0.3"]}' -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" https://127.0.0.1/external/v1/maintenanceWindow
```


---
### PUT

Allows you to update the maintenance window duration after you start the maintenance process by changing the **ttl** parameter. The new duration definition overrides the previous one.

This method is useful when you want to set a longer duration than the currently configured duration.

# [Request command](#tab/maintenanceWindow-put-request)

**Query parameters**:

|Name  |Description  |
|---------|---------|
|**ticketId**     |   Defines the maintenance ticket ID in the user's systems.      |
|**ttl**     |  Defines the duration of the window in minutes.       |

# [Response command](#tab/maintenanceWindow-put-response)

**Error codes**:

|Code  |Description  |
|---------|---------|
|**200 (OK)**     |  The action was successfully completed.       |
|**400 (Bad Request)**     | Appears in the following cases:<br><br>   - The **ttl** parameter is not numeric or not positive.<br>   - The **ticketId** parameter is missing.<br>   - The **ttl** parameter is missing.        |
|**404 (Not Found)**:     |  The ticket ID is not linked to an open maintenance window.       |
|**500 (Internal Server Error)**     |  Any other unexpected error.       |

> [!NOTE]
> Make sure that the ticket ID is linked to an existing open window.


# [Curl command](#tab/maintenanceWindow-put-curl)

**Type**: PUT

**API**:

```rest
curl -k -X PUT -d '{"ticketId": "<TICKET_ID>",ttl": "<TIME_TO_LIVE>"}' -H "Authorization: <AUTH_TOKEN>" https://127.0.0.1/external/v1/maintenanceWindow
```

**Example**:

```rest
curl -k -X PUT -d '{"ticketId": "a5fe99c-d914-4bda-9332-307384fe40bf","ttl": "20"}' -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" https://127.0.0.1/external/v1/maintenanceWindow
```
---


### DELETE

Closes an existing maintenance window.

# [Request](#tab/maintenanceWindow-delete-request)

**Query parameters**:

|Name  |Description  |
|---------|---------|
|**ticketId**     |   Defines the maintenance ticket ID in the user's systems.      |

# [Response](#tab/maintenanceWindow-delete-response)

**Error codes**:

|Code  |Description  |
|---------|---------|
|**200 (OK)**     |  The action was successfully completed.       |
|**400 (Bad Request)**     | The **ticketId** parameter is missing.       |
|**404 (Not Found)**:     |  The ticket ID is not linked to an open maintenance window.       |
|**500 (Internal Server Error)**     |  Any other unexpected error.       |


> [!NOTE]
> Make sure that the ticket ID is linked to an existing open window.

# [Curl command](#tab/maintenanceWindow-delete-curl)

**Type**: DELETE

**API**:

```rest
curl -k -X DELETE -d '{"ticketId": "<TICKET_ID>"}' -H "Authorization: <AUTH_TOKEN>" https://127.0.0.1/external/v1/maintenanceWindow
```

**Example**:

```rest
curl -k -X DELETE -d '{"ticketId": "a5fe99c-d914-4bda-9332-307384fe40bf"}' -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" https://127.0.0.1/external/v1/maintenanceWindow
```

---
### GET

Retrieve a log of all the open, close, and update actions that were performed in the system during the maintenance. You can retrieve a log only for maintenance windows that were active in the past and have been closed.

# [Request](#tab/maintenanceWindow-request-put)

**Query parameters**:

|Name  |Description  |
|---------|---------|
| **fromDate** | Filters the logs from the predefined date and later. The format is `YYYY-MM-DD`.|
| **toDate** | Filters the logs up to the predefined date. The format is `YYYY-MM-DD`. |
| **ticketId** | Filters the logs related to a specific ticket ID. |
| **tokenName** | Filters the logs related to a specific token name. |

**Error codes**:

|Code  |Description  |
|---------|---------|
|**200 (OK)**     |  The action was successfully completed.       |
|**400 (Bad Request)**     | The date format is wrong.     |
|**204 (No Content)**:     |  There is no data to show.      |
|**500 (Internal Server Error)**     |  Any other unexpected error.       |


# [Response](#tab/maintenanceWindow-response-put)

**Type**: JSON

Array of JSON objects that represent maintenance window operations.

**Response structure**:

| Name | Type | Comment | Nullable |
|--|--|--|--|
| **dateTime** | String | Example: "2012-04-23T18:25:43.511Z" | no |
| **ticketId** | String | Example: "9a5fe99c-d914-4bda-9332-307384fe40bf" | no |
| **tokenName** | String | - | no |
| **engines** | Array of string | - | yes |
| **sensorIds** | Array of string | - | yes |
| **subnets** | Array of string | - | yes |
| **ttl** | Numeric | - | yes |
| **operationType** | String | Values are "OPEN", "UPDATE", and "CLOSE" | no |

# [Curl command](#tab/maintenanceWindow-get-curl)

**Type**: GET

**API**:

```rest
curl -k -H "Authorization: <AUTH_TOKEN>" 'https://<IP_ADDRESS>/external/v1/maintenanceWindow?fromDate=&toDate=&ticketId=&tokenName='
```

**Example**:

```rest
curl -k -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" 'https://127.0.0.1/external/v1/maintenanceWindow?fromDate=2020-01-01&toDate=2020-07-14&ticketId=a5fe99c-d914-4bda-9332-307384fe40bf&tokenName=a'
```

---


## pcap (Request alert PCAP)

Use this API to request a PCAP file related to an alert.

**URI**: `/external/v2/alerts/`
### GET

# [Request](#tab/pcap-request)

**Query parameters**:


|Name  |Description  |Example  |
|---------|---------|---------|
|id     | CM alert ID        |    `/external/v2/alerts/pcap/<id>`     |

# [Request](#tab/pcap-response)

**Type**: JSON

Message string with the operation status details:

|Name  |Description |
|---------|---------|
|**Success**     |  JSON object that contains data regarding the requested PCAP file       |
|**Failure**     |  JSON object that contains error message       |

#### Data fields

|Name|Type|Nullable|
|-|-|-|
|id|Numeric|No|
|xsenseId|Numeric|No|
|xsenseAlertId|Numeric|No|
|downloadUrl|String|No|
|token|String|No|


**Response example**: Success

```json
{
  "downloadUrl": "https://10.1.0.2/api/v2/alerts/pcap/1",
  "xsenseId": 1,
  "token": "d2791f58-2a88-34fd-ae5c-2651fe30a63c",
  "id": 1,
  "xsenseAlertId": 1
}
```

**Response example**: Error


```json
{
  "error": "alert not found"
}
```

# [Curl command](#tab/pcap-curl)

**Type**: GET

**APIs**

```rest
curl -k -H "Authorization: <AUTH_TOKEN>" 'https://<IP_ADDRESS>/external/v2/alerts/pcap/<ID>'
```

***Example**:

```rest
curl -k -H "Authorization: 1234b734a9244d54ab8d40aedddcabcd" 'https://10.1.0.1/external/v2/alerts/pcap/1'
```

## Next steps

For more information, see:

- [Defender for IoT API reference](references-work-with-defender-for-iot-apis.md)
- [OT monitoring sensor APIs](sensor-api-reference.md)
- [ServiceNow integration API reference (Public preview)](servicenow-api-reference.md)