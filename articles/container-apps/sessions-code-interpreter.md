---
title: Serverless code interpreter sessions in Azure Container Apps
description: 
services: container-apps
author: craigshoemaker
ms.service: container-apps
ms.topic: conceptual
ms.date: 04/04/2024
ms.author: cshoe
---

# Serverless code interpreter sessions in Azure Container Apps

Azure Container Apps [dynamic sessions](sessions.md) provides fast and scalable access to a code interpreter. Each code interpreter session is fully isolated and can be used to run untrusted code.

> [!NOTE]
> Azure Container Apps dynamic sessions is currently in preview.

## Uses for code interpreter sessions

Code interpreter sessions are ideal for scenarios where you need to run code that is potentially malicious or could cause harm to the host system or other users, such as:

- Code generated by a large language model (LLM).
- Code submitted by an end user in a web or SaaS application.

For popular LLM frameworks, such as LangChain, LlamaIndex, or Semantic Kernel, you can use [tools and plugins](#llm-framework-integrations) to integrate AI apps with code interpreter sessions.

Your applications can also integrate with the code interpreter session using a [REST API](#management-api-endpoints). The API allows you to execute code in a session and retrieve the results. You can also upload and download files to and from the session. The files can be code files that are run or data files that are processed by the code.

## Code interpreter session pool

To use code interpreter sessions, you need an Azure resource called a session pool that defines the configuration for code interpreter sessions. In the session pool, you can specify settings such as the maximum number of concurrent sessions and how long a session can be idle before it is terminated.

You can create a session pool using the Azure portal, Azure CLI, or Azure Resource Manager templates. After you create a session pool, you can use the pool's management API endpoints to manage and execute code in sessions.

### Create a session pool with Azure CLI

To create a session pool with the Azure CLI, use the `az containerapps sessionpool create` command. The following example creates a Python code interpreter session pool named `my-session-pool`:

```bash
az containerapps sessionpool create \
    --name my-session-pool --resource-group my-resource-group \
    --location westus2 \
    --pool-type python-lts \
    --max-concurrent-sessions 100 \
    --cooldown-period-in-seconds 300
```

You can define the following settings when you create a session pool:

| Setting | Description |
|---------|-------------|
| `--pool-type` | The type of code interpreter to use. The only currently supported value is `python-lts`. |
| `--max-concurrent-sessions` | The maximum number of sessions that can be concurrently in use. |
| `--cooldown-period-in-seconds` | The number of seconds that a session can be idle before it is terminated. The idle period is reset each time the session's API is called. |

### Get the pool management API endpoint with Azure CLI

To use code interpreter sessions with LLM framework integrations or by calling the management API endpoints directly, you need the pool's management API endpoint. The endpoint is in the format `https://<region>.dynamicsessions.io/subscriptions/<subscription-id>/resourceGroups/<resource-group>/sessionPools/<session-pool-name>/`.

To retrieve the management API endpoint for a session pool, use the `az containerapps sessionpool show` command:

```bash
az containerapps sessionpool show \
    --name my-session-pool --resource-group my-resource-group \
    --query 'properties.poolManagementEndpoint' -o tsv
```

## Code execution in a session

After you create a session pool, your application can interact with sessions in the pool using an integration with an LLM framework or by using the pool's management API endpoints directly.

### Session identifiers

When you interact with sessions in a pool, you use a session identifier to reference each session. If there's a running session with the identifier, the session is reused. If there's no running session with the identifier, a new session is automatically created.

The session identifier is a string that you define that is unique within the session pool. If you're building a web application, you can use the user's ID. If you're building a chatbot, you can use the conversation ID.

### Authentication

Authentication is handled using Microsoft Entra (formerly Azure Active Directory) tokens. The token must be a valid Microsoft Entra token generated by an identity that has the `Azure ContainerApps Session Creator` or `Contributor` role on the session pool.

If you're using an LLM framework integration, the framework will handle the token generation and management for you. Ensure that the application has been configured with a managed identity that has the necessary role assignments on the session pool.

If you're using the pool's management API endpoints directly, you must generate a token and include it in the `Authorization` header of your HTTP requests. In addition to the role assignments mentioned above, token must also contain an audience (`aud`) claim with the value `https://dynamicsessions.io`.

### LLM framework integrations

Instead of using the session pool management API directly, the following LLM frameworks provide integrations with code interpreter sessions:

| Framework | Package | Quickstart |
|-----------|---------|------------|
| LangChain | Python: `langchain-azure-container-apps`<br>Node.js: `@langchain/azure-container-apps` | [Quickstart](./sessions-get-started-langchain.md) |
| LlamaIndex | Python: `llamaindex-azure-container-apps`<br>Node.js: `@llamaindex/azure-container-apps` | [Quickstart](./sessions-get-started-llamaindex.md) |
| Semantic Kernel | Python: `semantic-kernel-azure-container-apps`<br>.NET: `tbd`<br>Java: `tbd` | [Quickstart](./sessions-get-started-semantic-kernel.md) |

### Management API endpoints

If you're not using an LLM framework integration, you can interact with the session pool directly using the management API endpoints.

The following endpoints are available for managing sessions in a pool:

| Endpoint path | Method | Description |
|----------|--------|-------------|
| `execute` | `POST` | Execute code in a session. |
| `uploadFile` | `POST` | Upload a file to a session. |
| `downloadFile` | `GET` | Download a file from a session. |
| `files` | `GET` | List the files in a session. |

Build the full URL for each endpoint by concatenating the pool's management API endpoint with the endpoint path. The query string must include an `identifier` parameter containing the session identifier. For example: `https://<region>.dynamicsessions.io/subscriptions/<subscription-id>/resourceGroups/<resource-group>/sessionPools/<session-pool-name>/execute?identifier=<identifier>`.

#### Execute code in a session

To execute code in a session, send a `POST` request to the `execute` endpoint with the code to run in the request body. This example prints "Hello, world!" in Python and returns the output:

```http
POST https://<region>.dynamicsessions.io/subscriptions/<subscription-id>/resourceGroups/<resource-group>/sessionPools/<session-pool-name>/execute?identifier=<session-id>
Content-Type: application/json
Authorization: Bearer <token>

{
    "properties": {
        "codeInputType": "inline",
        "executionType": "synchronous",
        "code": "print('Hello, world!')"
    }
}
```

Replace the placeholders with the appropriate values for your session pool and session identifier. To re-use a session, specify the same session identifier in subsequent requests.

#### Upload a file to a session

To upload a file to a session, send a `POST` request to the `uploadFile` endpoint in a multipart form data request. Include the file data in the request body.

```http
POST https://<region>.dynamicsessions.io/subscriptions/<subscription-id>/resourceGroups/<resource-group>/sessionPools/<session-pool-name>/uploadFile?identifier=<session-id>
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW
Authorization: Bearer <token>

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="myfile.csv"
Content-Type: application/octet-stream

(data)
------WebKitFormBoundary7MA4YWxkTrZu0gW--
```

#### Download a file from a session

To download a file from a session, send a `GET` request to the `downloadFile` endpoint. The response will contain the file data.

```http
GET https://<region>.dynamicsessions.io/subscriptions/<subscription-id>/resourceGroups/<resource-group>/sessionPools/<session-pool-name>/downloadFile?identifier=<session-id>&file=myfile.csv
Authorization: Bearer <token>
```

#### List the files in a session

To list the files in a session, send a `GET` request to the `files` endpoint.

```http
GET https://<region>.dynamicsessions.io/subscriptions/<subscription-id>/resourceGroups/<resource-group>/sessionPools/<session-pool-name>/files?identifier=<session-id>
Authorization: Bearer <token>
```

The response contains a list of files in the session.

```json
{
    "$id": "1",
    "$values": [
        {
            "$id": "2",
            "filename": "test1.txt",
            "size": 16,
            "last_modified_time": "2024-04-23T19:36:14.5839269Z"
        },
        {
            "$id": "3",
            "filename": "test2.txt",
            "size": 17,
            "last_modified_time": "2024-04-23T19:36:15.2879262Z"
        },
        {
            "$id": "4",
            "filename": "test3.txt",
            "size": 17,
            "last_modified_time": "2024-04-23T19:36:15.9359256Z"
        },
        {
            "$id": "5",
            "filename": "testdata.txt",
            "size": 17,
            "last_modified_time": "2024-04-23T19:36:16.4999251Z"
        }
    ]
}
```

## Pre-installed packages

Python code interpreter sessions include popular Python packages such as NumPy, pandas, and scikit-learn.

To output the list of pre-installed packages, call the `execute` endpoint with the following code:

```http
POST https://<region>.dynamicsessions.io/subscriptions/<subscription-id>/resourceGroups/<resource-group>/sessionPools/<session-pool-name>/identifier/<session-id>/execute
Content-Type: application/json
Authorization: Bearer <token>
    
{
    "properties": {
        "codeInputType": "inline",
        "executionType": "synchronous",
        "code": "import pkg_resources\n[(d.project_name, d.version) for d in pkg_resources.working_set]"
    }
}
```

## Next steps

> [!div class="nextstepaction"]
> [Quickstart: use code interpreter sessions with LangChain](./sessions-get-started-langchain.md)
