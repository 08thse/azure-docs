---
title: Migrate an NFS share to an Azure blob container using Azure Storage Mover
description: Learn how to migrate an NFS share to an Azure blob container using Azure Storage Mover
author: stevenmatthew
ms.author: shaas
ms.service: storage-mover
ms.topic: tutorial
ms.date: 06/21/2022
ms.custom: template-tutorial
---

# Tutorial: Migrate an NFS share to an Azure blob container using Azure Storage Mover

After your cloud resources are deployed and the agent VM is registered, it’s time to start a copy.

In this tutorial, you learn how to:

> [!div class="checklist"]
> * All tutorials include a list summarizing completion steps
> * Each of these bullet points align to a key H2
> * Use these green checkboxes in a tutorial

<!-- 4. Prerequisites 

##Docs Required##

First prerequisite is a link to a free trial account if one exists. If there are no prerequisites, specify that no prerequisites are needed for this quickstart.
-->

## Prerequisites

There are only two prerequisites to running the script:

- An Azure account with an active subscription. [Create an account for free]
  (https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
- A Data Mover resource in an Azure resource group.

  There is no portal support at this time. You can verify this prerequisite using the following PowerShell cmdlet.

  ```azurepowershell
  Get-AzDataMover -ResourceGroup [myResourceGroup]
  ```

- An available NFS share on a machine accessible by the agent on its local network.
  Reference the machine by IP when making the source Endpoint to avoid DNS issues. The path for an NFS share adheres to the following structure: ```<serverIP>:/<shareName>```. An NFS share is also known as an “NFS export”.


## Prepare your migration resources

To summarize the step involved in this section: You must first configure your endpoints, project, and job definition. To describe the outcome of this section: After completion, you will run the actual script.

The PowerShell module is autogenerated in this release, therefore the provided automation script *prepare-migration.ps1* simplifies the process of creating the necessary resources to describe a migration. Updated PowerShell and Azure portal integration will improve the experience over time.

The script will create the following resources:

1. A Data Mover Project, it will contain a Job Definition.
1. A Data Mover Endpoint with info about the migration source (an NFS share only for this private preview release).
1. A Data mover Endpoint with info about the migration target (an Azure Blob Storage container only for this private preview release).
1. A Job Definition referencing the source and target endpoints.

In addition, the script will authorize the Agent to read and write to the target storage container using Azure role-based access control (RBAC). This is done using the account the admin is logged in with. Your account will need to have Owner permissions on the target storage account to grant access to the Agent. By design, the Storage Mover service cannot grant access to agents. Please note that in this release, agent permissions are not automatically revoked after a migration job finishes.

The Agent does not have access to the Storage Access Keys or a SAS token to the migration target. 
The Agent uses a managed identity created when the Agent registered to Azure. The identity is 
unique to the Agent and its lifetime is linked to the Agent. This identity will also show in the access 
logs.

Reference the Microsoft docs for an [Overview of Azure Managed Identities](../active-directory/managed-identities-azure-resources/overview.md).

## Run the script

Summarize the steps involved in this section. Describe the outcome of this section.

To run the script, navigate in your PowerShell window to the “script” folder in the extracted preview package you’ve downloaded from Yammer. This is the same package that also includes the Storage Mover PowerShell module you’ve previously installed.

```azurepowershell
    Connect-AzAccount –SubscriptionID [yourID]
    .\prepare-migration.ps1 `
     -DataMoverName [yourDataMoverName] `
     -DataMoverResourceGroup [yourDataMoverResourceGroup] `
     -AgentName [yourAgentName] `
     -MigrationJobName [yourJobDefinitionName] `
     -SourceHostName [yourSourceHostName] `
     -SourceRemoteExportName [yourRemoteExportName] `
     -SourceNfsVersion [yourSourceNfsVersion] `
     -SourceSubpath [yourSourceSubpath] #optional `
     -TargetStorageAccountName [yourTargetStorageAccountName] `
     -TargetResourceGroup [yourTargetResourceGroup] `
     -TargetContainerName [yourTargetContainerName]
     -TargetSubPath [optionalTargetSubPath] #optional
```

Reference your DataMover resource and Resource Group from the previous Step 1. Choose a name for `yourJobDefinitionName`. For simplicity, this will be used to name both the Data Mover Project and Job Definition resources. If you use the cmdlets individually, you’d be able to assign different names.

The following parameters are used for the migration source:

- `yourSourceHostName` - The hostname or IP address of the NFS server. Reference by IP to avoid DNS issues.
- `yourSourceRemoteExportName` - Your NFS export. The path for an NFS share is structured like: `*serverIP*:/*shareName*` The script will construct that. For this parameter, enter only the `*shareName*` part. An NFS share is also known as an "NFS export".
- `yourSourceNfsVersion` - This must be the string 'NFSv3' or 'NFSv4'.
- `yourSourceSubpath` - This is the path from the source export root to use as migration root. All files and folders contained in the subpath will be recursively copied as part of the migration.

The following parameters are used for the migration target:

- `yourTargetStorageAccount` - The name of the storage account to migrate to.
- `yourTargetResourceGroup` - The resource group of the storage account.
- `yourTargetContainerName` - The name of the container to write to. (created if doesn’t exist)
- `yourTargetSubPath` - An optional path into which the contents of the source is copied (created if it doesn’t exist)

Describe how this section impacts the end-result.

## Clean up resources

Clean up all resources, or they may be stuck in your subscription w/o a chance to delete them later. When you have completed this private preview round, you’ll have multiple resources in your Resource Group. Some of them show in the Azure portal, some don’t.

- Resource group: You should have all preview resources together in one resource group.
- Data mover: In this release, the primary Storage Mover resource is called a “Data Mover”. It won’t show in 
the portal. It holds several other resources:
  - Data Mover agent
  - Project
  - Job Definition
  - Job Run
- Storage account: Each data mover will get a “Command & Control” storage account, which orchestrates 
remote agent management.
- Storage account: As a migration target, there should be at least one target storage account with a container 
in it, holding the files of your migration (Job Run).
- Arc server: As part of agent registration, Azure Arc has added an Arc Server resource to your resource group. 
The managed identity of the agent is tied to this resource. Your agent is therefore represented by two Azure 
resources. 1) This Arc server 2) the Data Mover Agent resource, nested in your Data Mover resource.

> [!IMPORTANT]
> At a minimum, remove the Data Mover resource from your resource group. There will be breaking changes between private preview releases, that could get the Data Mover resource orphaned – with no ability to delete it later.

The simplest way to remove resources is to delete the resource group. When you send this instruction in the portal, or via PowerShell, Azure Resource Manager (ARM) will reach out to all resource providers with affected resources. It instructs them to delete the affected resources.

<!-- 7. Next steps

##Docs required###

A single link in the blue box format. Point to the next logical tutorial or how-to in a series, or, if there are no other tutorials or how-tos, to some other cool thing the customer can do.
-->

## Next steps

Advance to the next article to learn how to create...
> [!div class="nextstepaction"]
> [Next steps button](overview.md)
