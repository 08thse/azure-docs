---
title: Use a Microsoft Sentinel playbook to stop potentially compromised users
description: Learn how to use Microsoft Sentinel playbooks and autoamation rules to automate a sample incident response and remediate security threats.
ms.topic: tutorial
author: batamig
ms.author: bagol
ms.date: 04/17/2024
appliesto:
    - Microsoft Sentinel in the Azure portal
    - Microsoft Sentinel in the Microsoft Defender portal
ms.collection: usx-security
---

# Use a Microsoft Sentinel playbook to stop potentially compromised users

This article describes a sample scenario of how you might use a playbook with an automation rule to automate incident response and remediate security threats. Automation rules help you triage incidents in Microsoft Sentinel, and are also used to run playbooks in response to incidents or alerts. 

Alternately, you might want to run your playbooks automatically in response to alerts, by telling the analytics rule to automatically run a playbook whenever the alert is generated, or manually as a response to a selected alert, incident, or entity.

> [!NOTE]
> Because playbooks make use of Azure Logic Apps, additional charges may apply. Visit the [Azure Logic Apps](https://azure.microsoft.com/pricing/details/logic-apps/) pricing page for more details.

[!INCLUDE [unified-soc-preview](../includes/unified-soc-preview.md)]

## What are playbooks?

Playbooks are collections of procedures that can be run from Microsoft Sentinel in response to an entire incident, to an individual alert, or to a specific entity. A playbook can help automate and orchestrate your response, and can be set to run automatically when specific alerts are generated or when incidents are created or updated, by being attached to an automation rule. Playbooks can also be run manually, on-demand, for specific incidents, alerts, or entities.

Playbooks in Microsoft Sentinel are based on workflows built in [Azure Logic Apps](/azure/logic-apps/logic-apps-overview), which means that you get all the power, customizability, and built-in templates of Logic Apps. Each playbook is created for a specific subscription, and Microsoft Sentinel displays all playbooks available across any selected subscriptions.

## Prerequisites

The following roles are required to use Azure Logic Apps to create and run playbooks in Microsoft Sentinel.

[!INCLUDE [playbooks-roles](../includes/playbooks-roles.md)]

### Extra permissions required to run playbooks on incidents

[!INCLUDE [playbooks-service-account-permissions](../includes/playbooks-service-account-permissions.md)]

## Sample playbook flow to stop potentially compromised users

You'll want to make sure that potentially compromised users can't move around your network and steal information. We recommend that you create an automated, multifaceted response to incidents generated by rules that detect compromised users.

Create your playbook to use the following flow:

1. An incident is created for a potentially compromised user and an automation rule is triggered to call your playbook.

1. The playbook opens a ticket in your IT ticketing system, such as in ServiceNow.

1. The playbook also sends a message to your security operations channel in Microsoft Teams or Slack to make sure your security analysts are aware of the incident.

1. The playbook also sends all the information in the incident in an email message to your senior network admin and security admin. The email message will include **Block** and **Ignore** user option buttons.

1. The playbook waits until a response is received from the admins, then continues with its next steps.

1. If the admins choose **Block**, it sends a command to Microsoft Entra ID to disable the user, and one to the firewall to block the IP address.

1. If the admins choose **Ignore**, the playbook closes the incident in Microsoft Sentinel, and the ticket in ServiceNow.

The following screenshot shows the actions and conditions you would add in creating this sample playbook:

:::image type="content" source="../media/tutorial-respond-threats-playbook/logic-app.png" alt-text="Screenshot of a Logic App showing this playbook's actions and conditions.":::

## Related content

- [Automate threat response with playbooks in Microsoft Sentinel](automate-responses-with-playbooks.md)
- [Create and manage Microsoft Sentinel playbooks](create-playbooks.md)
- [Use a Microsoft Sentinel playbook to stop potentially compromised users](tutorial-respond-threats-playbook.md)
