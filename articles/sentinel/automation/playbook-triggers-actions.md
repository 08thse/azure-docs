---
title: Use triggers and actions in Microsoft Sentinel playbooks | Microsoft Docs
description: Learn in greater depth how to give your playbooks access to the information in your Microsoft Sentinel alerts and incidents and use that information to take remedial actions.
ms.topic: how-to
author: batamig
ms.author: bagol
ms.date: 03/14/2024
appliesto:
    - Microsoft Sentinel in the Azure portal
    - Microsoft Sentinel in the Microsoft Defender portal
ms.collection: usx-security

---

# Use triggers and actions in Microsoft Sentinel playbooks

This article describes the triggers and actions supported by the [Logic Apps Microsoft Sentinel connector](/connectors/azuresentinel/). Use the listed triggers and actions in Microsoft Sentinel playbooks to interact with your Microsoft Sentinel data.

> [!IMPORTANT]
>
> Noted functionality is currently in **PREVIEW**. See the [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) for additional legal terms that apply to Azure features that are in beta, preview, or otherwise not yet released into general availability.

## Prerequisites

Before you start, make sure that you have the following Azure permissions required to use Microsoft Sentinel connector components:

| Role | Use triggers | Get available actions | Update incident,<br>add a comment |
| ------------- | :-----------: | :------------: | :-----------: |
| **[Microsoft Sentinel Reader](/azure/role-based-access-control/built-in-roles#microsoft-sentinel-reader)** | &#10003; | &#10003; |**-**  |
| **Microsoft Sentinel [Responder](/azure/role-based-access-control/built-in-roles#microsoft-sentinel-responder)/[Contributor](/azure/role-based-access-control/built-in-roles#microsoft-sentinel-contributor)** | &#10003; | &#10003; | &#10003; |

For more information, see [Roles and permissions in Microsoft Sentinel](../roles.md) and [prerequisites for working with Microsoft Sentinel playbooks](automate-responses-with-playbooks.md#prerequisites).

## Supported Microsoft Sentinel triggers

The Microsoft Sentinel connector, and therefore Microsoft Sentinel playbooks, support the following triggers:

- **Microsoft Sentinel incident (Preview)**. Recommended for most incident automation scenarios.

    The playbook receives incident objects, including both entities and alerts. This trigger allows you to attach a playbook to an automation rule that it can be triggered whenever an incident is created or updated in Microsoft Sentinel.<!--does this say anything? All the [benefits of handing automation rules](./automate-incident-handling-with-automation-rules.md) can be applied to the incident.-->

- **Microsoft Sentinel alert (Preview)**. Recommended for playbooks that must be run manually on alerts, or for scheduled analytics rules that don't generate incidents for their alerts.

    - This trigger can't be used to automate responses for alerts generated by *Microsoft security* analytics rules.
    - Playbooks using this trigger can't be called by automation rules.

- **Microsoft Sentinel entity (Preview)**. Recommended for playbooks that must be run manually on specific entities from an investigation or threat hunting context. Playbooks using this trigger can't be called by automation rules.

The schemas used by these flows aren't identical. We recommend using the **Microsoft Sentinel incident trigger** flow for most scenarios.

### Incident dynamic fields

The **Incident** object received from **Microsoft Sentinel incident** includes the following dynamic fields:

|Field name  |Description  |
|---------|---------|
|**Incident properties**     | Shown as *Incident: \<field name>*        |
|**Alerts**     | An array of the following alert properties, shown as *Alert: \<field name>*.  <br><br>Since each incident can include multiple alerts, selecting an alert property automatically generates a *for each* loop to cover all alert in the incident. |
|**Entities**     |  An array of all the alert's entities       |
|**Workspace info fields**     | Details about the Microsoft Sentinel workspace where the incident was created, including: <br><br>- Subscription ID<br>  - Workspace name <br>- Workspace ID <br>  - Resource group name    |

## Supported Microsoft Sentinel actions

The Microsoft Sentinel connector, and therefore Microsoft Sentinel playbooks, support the following actions:

| Action | When to use it |
| --------- | -------------- |
| **Alert - Get Incident** | In playbooks that start with Alert trigger. Useful for getting the incident properties, or retrieving the **Incident ARM ID** to use with the **Update incident** or **Add comment to incident** actions. |
| **Get Incident** | When triggering a playbook from an external source or with a non-Sentinel trigger. Identify with an **Incident ARM ID**. Retrieves the incident properties and comments. |
| **Update Incident** | To change an incident's **Status** (for example, when closing the incident), assign an **Owner**, add or remove a tag, or to change its **Severity**, **Title**, or **Description**.
| **Add comments to incident** | To enrich the incident with information collected from external sources; to audit the actions taken by the playbook on the entities; to supply additional information valuable for incident investigation. |
| **Entities - Get \<*entity type*\>** | In playbooks that work on a specific entity type (**IP**, **Account**, **Host**, **URL, or **FileHash**) which is known at playbook creation time, and you need to be able to parse it and work on its unique fields. |

> [!TIP] 
> The actions **Update Incident** and **Add a Comment to Incident** require the **Incident ARM ID**.
>
> Use the **Alert - Get Incident** action beforehand to get the **Incident ARM ID**.

## Work with specific entity types

The **Entities** dynamic field is an array of JSON objects, each of which represents an entity. Each entity type has its own schema, depending on its unique properties.

The **"Entities - Get \<entity type>"** action allows you to:

- Filter the array of entities by the requested type.
- Parse the specific fields of this type, so they can be used as dynamic fields in further actions.

The input is the **Entities** dynamic field.

The response is an array of entities, where the special properties are parsed and can be directly used in a *For each* loop.

Currently supported entity types include:

- [IP](/connectors/azuresentinel/#entities---get-ips)
- [Host](/connectors/azuresentinel/#entities---get-hosts)
- [Account](/connectors/azuresentinel/#entities---get-accounts)
- [URL](/connectors/azuresentinel/#entities---get-urls)
- [FileHash](/connectors/azuresentinel/#entities---get-filehashes)

The following image shows an example of available actions for entities:

:::image type="content" source="../media/playbook-triggers-actions/entities-actions.png" alt-text="Screenshot of an entities actions list":::

For other entity types, similar functionality can be achieved using Logic Apps' built-in actions:

- Filter the array of entities by the requested type using [**Filter Array**](/azure/logic-apps/logic-apps-perform-data-operations#filter-array-action).

- Parse the specific fields of this type, so they can be used as dynamic fields in further actions using [**Parse JSON**](/azure/logic-apps/logic-apps-perform-data-operations#parse-json-action).

### Use entity playbooks with no incident ID

Playbooks created with the entity trigger often use the **Incident ARM ID** field, such as to update an incident after taking action on the entity.

If such a playbook is triggered in a context unconnected to an incident, such as when threat hunting, there's no incident whose ID can populate this field. In this case, the field is populated with a null value.

As a result, the playbook might fail to run to completion. To prevent this failure, we recommend that you create a condition that checks for a value in the incident ID field before taking any actions on it, and prescribe a different set of actions if the field has a null value - that is, if the playbook isn't being run from an incident.

Do the following steps:

1. Before the first action that refers to the **Incident ARM ID** field, add a step of type **Condition**.

1. Select the **Choose a value** field and enter the **Add dynamic content** dialog.

1. Select the **Expression** tab and the **length(collection)** function.

1. Select the **Dynamic content** tab and the **Incident ARM ID** field.

1. Verify the resulting expression is `length(triggerBody()?['IncidentArmID'])` and select **OK**. For example:

    :::image type="content" source="../media/playbook-triggers-actions/condition-incident-id.png" alt-text="Screenshot of dynamic content dialog to select fields for a playbook condition.":::

1. Set the **operator** and **value** in the condition to **is greater than** and **0**. For example:

    :::image type="content" source="../media/playbook-triggers-actions/condition-length.png" alt-text="Screenshot of final definition of condition described in the previous screenshot.":::

1. In the **True** frame, add the actions to be taken if the playbook is run from an incident context.

    In the **False** frame, add the actions to be taken if the playbook is run from a nonincident context.

## Work with custom details

The **Alert custom details** dynamic field, available in the **incident trigger**, is an array of JSON objects, each of which represents a custom detail of an alert. [Custom details](../surface-custom-details-in-alerts.md) are key-value pairs that allow you to surface information from events in the alert so they can be represented, tracked, and analyzed as part of the incident.

Since this field in the alert is customizable, its schema depends on the type of event being surfaced. Supply data from an instance of this event to generate the schema that determines how the custom details field is parsed.

For example:

:::image type="content" source="../media/playbook-triggers-actions/custom-details-values.png" alt-text="Screenshot of custom details defined in an analytics rule.":::

In these key-value pairs:

- The key, in the left column, represents the custom fields you create.
- The value, in the right column, represents the fields from the event data that populate the custom fields.

Supply the following JSON code to generate the schema. The code shows the key names as arrays, and the values as items in the arrays. Values are shown as the actual values, not the column that contains the values.

```json
{ "FirstCustomField": [ "1", "2" ], "SecondCustomField": [ "a", "b" ] }
```

To use custom fields for incident triggers:

1. Add a new step using the **Parse JSON** built-in action. Enter 'parse json' in the **Search** field to find it if you need to.

1. Find and select **Alert Custom Details** in the **Dynamic content** list, under the incident trigger. For example:

    :::image type="content" source="../media/playbook-triggers-actions/custom-details-dynamic-field.png" alt-text="Screenshot of selecting Alert custom details from Dynamic content.":::

    This creates a **For each** loop, since an incident contains an array of alerts.

1. Select the **Use sample payload to generate schema** link. For example:

    :::image type="content" source="../media/playbook-triggers-actions/generate-schema-link.png" alt-text="Screenshot of selecting the use sample payload to generate schema link from Dynamic content option.":::

1. Supply a sample payload. You can find a sample payload by looking in Log Analytics for another instance of this alert, and copying the custom details object (under **Extended Properties**). Access Log Analytics data either in the **Logs** page in the Azure portal or the **Advanced hunting** page in the Defender portal. In the screenshot below, we used the JSON code shown above.

    :::image type="content" source="../media/playbook-triggers-actions/sample-payload.png" alt-text="Screenshot of entering a sample JSON payload.":::

The custom fields are ready to be used as dynamic fields of type **Array**. For example, the following screenshot shows an array and its items, both in the schema and in the list that appears under **Dynamic content**, that we described in this section:

:::image type="content" source="../media/playbook-triggers-actions/fields-ready-to-use.png" alt-text="Screenshot of fields from the schema ready to use.":::

## Related content

For more information, see:

- [Automate threat response with Microsoft Sentinel playbooks](automate-responses-with-playbooks.md)
- [Azure Logic Apps for Microsoft Sentinel playbooks](logic-apps-playbooks.md)
- [Authenticate playbooks to Microsoft Sentinel](authenticate-playbooks-to-sentinel.md)
- [Logic Apps Microsoft Sentinel connector documentation](/connectors/azuresentinel/)