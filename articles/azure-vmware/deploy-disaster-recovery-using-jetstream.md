---
title: Deploy disaster recovery using JetStream 
description: Learn how to deploy JetStream Disaster Recovery (DR) for your Azure VMware Solution private cloud and on-premises VMware workloads. 
ms.topic: how-to
ms.date: 07/15/2021

#Customer intent: 

---

# Deploy disaster recovery using JetStream

[JetStream Disaster Recovery (DR)](https://www.jetstreamsoft.com/product-portfolio/jetstream-dr/) is installed in a VMware vSphere environment and managed through a vCenter plug-in appliance. It provides cloud-native Continuous Data Protection (CDP), which constantly replicates virtual machine (VM) I/O operations. Instead of capturing snapshots at regular intervals, it continuously captures and replicates data as it's written to the primary storage with minimal effect on running applications.  It allows you to quickly recover VMs and their data, reaching a lower recovery point objective (RPO).  

With Azure VMware Solution, you can store data directly to a recovery cluster in vSAN or an attached file system like Azure NetApp Files. The data gets captured through I/O filters that run within vSphere. The underlying data store can be VMFS, VSAN, vVol, or any HCI platform. 

:::image type="content" source="media/jetstream-disaster-recovery/jetstream-disaster-recovery-diagram.png" alt-text="Diagram showing the JetStream DR and Azure VMware Solution integration." border="false":::

JetStream DR software consists of three main components: 

- Management Server Virtual Appliance (MSA) is installed and configured before DR protection. 

- DR Virtual Appliance (DRVA) is an .ISO image that is automatically deployed by the JetStream DR MSA.

- Host components (IO Filter packages) 

The MSA is used to install and configure host components on the compute cluster and then to administer JetStream DR software. The DRVA runs the data path DR components. Multiple DRVAs can run concurrently for better scalability. Each DRVA has one or more dedicated partitions attached as an iSCSI LUN or as a low‐latency VDISK. The partitions are used to maintain replication logs and repositories for persistent metadata.

In this article, you'll deploy and learn how to use JetStream DR in your Azure VMware Solution private cloud and on-premises VMware workloads.


## Supported scenarios
Depending on the protection services required and the type of private cloud being protected, you can deploy JetStream DR in two ways:

- On-premises to cloud

- Cloud to cloud

### On-premises to cloud deployment
VMs running in an organization's VMware‐based data center are continuously replicated to Microsoft Azure. As a result, VMs can resume operation in Azure VMware Solution if there's an incident in the on-premises data center. While the VMs are running in the recovery environment, they continue to replicate data for continued protection. After the on‐premises data center is restored, the VMs and their data (including any new data generated by the VMs in the recovery environment) can return to their original data center without interruption.

:::image type="content" source="media/jetstream-disaster-recovery/jetstream-on-premises-to-cloud-diagram.png" alt-text="Diagram showing the on-premises to Azure VMware Solution private cloud JetStream deployment." border="false":::

### Cloud to cloud deployment

In this configuration, Azure VMware Solution hosts the customer's primary environment in one data center. It protects the VMs and their data by continuously replicating to another private cloud in another of its data centers. If there is an incident, VMs and data are recovered in the second data center. This protection can be bi‐directional, with data center "A" protecting data center "B", and vice‐versa.

:::image type="content" source="media/jetstream-disaster-recovery/jetstream-cloud-to-cloud-diagram.png" alt-text="Diagram showing the Azure VMware Solution private cloud to private cloud JetStream deployment." border="false":::


## Prerequisites

- Azure VMware Solution private cloud must be deployed as a secondary region. 

- Customer has setup an Ubuntu Linux jump box with an ExpressRoute connection to their Azure VMware Solution private cloud. 

- Install the latest PowerShell onto the Linux jump box.

- Install the latest third-Party Module from PowerShell gallery.

### Protected site

The protected site hosts a **service cluster** for administrative services, such as vCenter, DNS, and Active Directory, and **computer clusters** where protected line-of-business applications run. The protected site can be located on-premises, or be hosted in Azure VMware Solution.

Any of the following types can be used:
- Azure Blob Storage
- Azure VMware Solution vSAN
- Azure VMware Solution attached file system, such as Azure NetApp Files


| Item  | Description  |  
| --- | --- |  
| **vCenter Server**  | <ul><li>Supported version: 6.7</li><li>HTTPS port: If using a firewall, HTTPS port 443 must be open.</li><li>Connectivity: The JetStream DR Management Server Appliance FQDN must be reachable from vCenter. Otherwise, the plug-in installation fails.</li><li>Time: The vCenter and JetStream DR MSA clocks must be synchronized.</li></ul>  |
| **Distributed Resource Schedular (DRS)**  | It’s recommended on the compute cluster for resource balancing.  |
| **Cluster**  | vSphere Hosts: VMs to be protected by JetStream DR must be part of a cluster.  |
| **vSphere Host**  | <ul><li>Supported version: 6.7U1 (build #10302608) or later</li><li>Connectivity: vCenter Server FQDN must be reachable from the host, otherwise the host configuration fails.</li><li>Time: The vSphere hosts and JetStream DR MSA clocks must be synchronized.</li><li>CIM Service: The CIM server must be enabled, which is the default setting.</li></ul>  |
| **JetStream DR MSA**  | <ul><li>CPU: 64 bit, 4 vCPUs</li><li>Memory: 4 GB</li><li>Disk space: 60 GB</li><li>Network: Static or dynamically assigned (DHCP) IP addresses can be used. The FQDN should be registered with DNS.</li><li>DNS: DNS name resolution for vSphere hosts and vCenter Server</li></ul>  |
| **JetStream DRVA**  | <ul><li>CPU: 4 cores</li><li>Memory: 8 GB</li><li>Network: Static or dynamically assigned (DHCP) IP addresses can be used.</li></ul>  |
| **Replication Log Store**  | For optimal performance, the protected site should expose a low-latency, flash storage device that the hosts share in the cluster. This device can be controlled by the JetStream DR software or provided by a third party. It's used as a repository for the replication log. The DRVA and ESXi host(s) must have direct access to this storage over iSCSI.  |
| **Ports**  | When JetStream DR software is installed, a range of ports is opened automatically on the source ESXi hosts. For most users, no more action is necessary. However, in cases where the on-premises/source setup has special firewall rules blocking these ports, you'll need to open these ports manually.<br /><br />Port range: 32873-32878  |



### Recovery site

An Azure VMware Solution “pilot light” cluster is established for failover recovery. Although the recovery site is created as part of the installation process, the recovery site cluster is not fully populated or used during normal operation. Failed over compute clusters are added to the recovery site on-demand in response to a disaster event.

### Network

A network with the following characteristics must be established between the protected site and the recovery site.

| Items | Description |
| --- | --- |
| **JetStream DR MSA**  | A management network is required for the MSA. This network is used for access to the JetStream DR RESTful APIs and making other data path calls. If a private network is available for connecting to the object store, this private network should be added to the MSA VM as a separate network. If no private network is available, make sure the management network can be used to connect to the object store.<br /><br />A dedicated external network can be used for object store access; otherwise, data traffic will be sent over the management network.  | 
| **JetStream DRVA**  | If the only network used is the management network, make sure it has access to both IO Filter and the object store. If multiple networks exist within the cluster, all must be attached to the DRVA VMs.  | 
| **Recovery from Object Cloud Virtual Appliance (RocVA)**  | If the only network used is the management network, make sure it has access to both the ESXi host(s) and the object store. If multiple networks exist within the cluster, all must be attached to the RocVA VM. The RocVA is a temporary VM created automatically when needed for VM recovery, then removed when it is no longer needed.  | 
| **Object store / blob storage**  | The object store/Blob Storage should be accessible to both the protected site and the recovery site.  | 
| **Replication log store**  | DRVAs and ESXi host(s) must have direct access to this storage over iSCSI.  | 



## Download MSA OVA and set up SSH access

1. Download and extract the MSA OVA installation file.

2. Provide SSH security in JetStream DR MSA.

   1. Edit the file [/etc/ssh/sshd_config](https://man7.org/linux/man-pages/man5/sshd_config.5.html) and add the SSH key.

   2. Set the PasswordAuthentication option to **yes** or **no**.

   3. Restart the [sshd](https://man7.org/linux/man-pages/man8/sshd.8.html) service.

      ```
      service sshd restart
      ```

You can add more SSH public keys manually to the /root/.ssh/authorized_keys or by running the [ssh‐copy‐id script](https://www.unix.com/man-page/linux/1/SSH-COPY-ID/).

If the directory or file doesn't exist, create it manually:

```
mkdir /root/.ssh 
echo "" >> /root/.ssh/authorized_keys 
chmod 600 /root/.ssh/authorized_keys 
chmod 700 /root/.ssh/ 
```


## Install and configure JetStream DR MSA 

1. Copy the OVA file to the workstation from which it can be deployed.

1. From the vSphere Web Client, connect to the vCenter Server with user credentials with administrator rights to provision and manage VMs.

1. Navigate to and select the OVA file that you downloaded and then select **Next**.

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-browse-ovf-template.png" alt-text="Screenshot showing the Deploy OVF Template wizard with the Local file option selected.":::

   

1. Provide a name for the management server VM and then select a datacenter.  Then select **Next**.

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-ovf-select-name-location.png" alt-text="Screenshot showing the virtual machine name and location for the virtual machine.":::

   
1. Select a resource to run the management server VM template and then select **Next**.

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-select-compute-resource.png" alt-text="Screenshot showing the destination compute resource selected.":::

   

1. Review the template details and select **Next**.

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-ovf-template-details.png" alt-text="Screenshot showing the template details for the JetStream DR management server.":::

   
1. Review license terms. If you agree, select the checkbox and then select **Next**. The installation of JetStream DR management server VM on the selected host begins.

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-accept-license-agreement.png" alt-text="Screenshot showing the Deploy OVF Template License agreements.":::

   

1. Specify the virtual disk format, VM storage policy, and the datastore. Then select **Next**.

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-select-storage.png" alt-text="Screenshot showing the virtual disk format for the JetStream DR management server.":::

   

1. Configure the network options and then select **Next**.

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-select-network.png" alt-text="Screenshot showing a destination network for each source network.":::

   

1. Provide a hostname, the password information, and the network properties for the management server. The select **Next**.

   >[!NOTE]
   >The hostname must be a unique and fully qualified domain name (FQDN) that can be accessed by the vCenter Server. Also, if a root user password is not specified, the default value of *JetStream* is used. 

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-customize-ovf-template.png" alt-text="Screenshot showing where to customize the OVF template deployment properties.":::

   

1. Verify the configuration, and then select **Finish** to deploy JetStream DR MSA. 

   :::image type="content" source="media/jetstream-disaster-recovery/jetstream-ready-to-deploy.png" alt-text="Screenshot showing the JetStream DR management server provisioning details.":::


## Register vCenter Server with MSA

After the MSA VM is deployed and reboots, you'll need to register the vCenter Server with the MSA.

1. In vCenter, right-click the JetStream DR MSA VM and select **Open Console**.  The IP address of the JetStream DR MSA displays in the terminal. 

2. Follow the instructions to register the vCenter Server and then sign into the JetStream DR MSA from a web browser.

3. Provide the details of the primary site vCenter Server to register the JetStream DR plug-in.

4. Once you see the confirmation of the successful registration, sign out of the vSphere Client and then sign into the JetStream DR plug-in.

5. Navigate to the datacenter where the MSA was installed and then select the **Configuration** tab. The JetStream DR interface appears.


## Prepare cluster for protection

Once you've installed JetStream DR on the vCenter Server, you'll need to configure various settings before you can protect a cluster.

JetStream DR is accessed at the data center level.  It's first deployed to the compute cluster, and then the IO filter software gets installed on all hosts in the cluster automatically. There are four aspects of the system that you must configure before starting protection:

- Configure the cluster with the IO Filter package.

- Install and configure DRVA.

- Add a storage site.

- Create a protection domain. 

For demos on using JetStream DR to protect VMs, see [JetStream DR for Azure VMware Solution](https://www.jetstreamsoft.com/solutions/disaster-recovery-for-azure-vmware-solution/#).


## Test the DR environment




## Uninstall JetStream




## Support




## Next steps

- [JetStream DR for Azure VMware Solution - Full demo](https://vimeo.com/475620858/2ce9413248)
   
   - [Getting started with JetStream DR for Azure VMware Solution](https://vimeo.com/491880696/ec509ff8e3)

   - [Configuration and Protecting VMs](https://vimeo.com/491881616/d887590fb2)

   - [Failover to Azure VMware Solution](https://vimeo.com/491883564/ca9fc57092)

   - [Failback to On-premises](https://vimeo.com/491884402/65ee817b60)

- [JetStream DR for Azure VMware Solution Infrastructure Setup](https://vimeo.com/480574312/b5386a871c) (*technical details, no voice track*)
