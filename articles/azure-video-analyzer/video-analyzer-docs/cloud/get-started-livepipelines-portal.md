---
title: Get started with Azure Video Analyzer live pipelines - Azure portal
description: This quickstart walks you through the steps to get started with Azure Video Analyzer live pipelines by using the Azure portal. Topic get you started with Continuous video recording (CVR) scenario from a live video source exposed over internet with Azure Video Analyzer live pipelines.
ms.service: azure-video-analyzer
ms.topic: quickstart
ms.date: 10/15/2021
---

# Quickstart: Get started with Azure Video Analyzer Live Pipelines - Azure portal

This quickstart walks you through the steps to get started with Azure Video Analyzer service to capture and record video from an RTSP camera.
You'll create an Azure Video Analyzer account and its accompanying resources by using the Azure portal. You will deploy a Real Time Streaming Protocol (RTSP) camera simulator, if you don’t have access to an actual RTSP camera (that can be made accessible over the internet). You’ll then deploy the relevant Video Analyzer resources to record video to your Video Analyzer account.

The steps outlined in this document apply to cameras that are made accessible over the internet, and not shielded behind a firewall. The following diagram graphically represents the live [pipeline](../pipeline.md) that you will deploy to your Video Analyzer account.

> :::image type="content" source="./media/live-pipeline.png" alt-text="Diagram of a live pipeline that captures live videos on the cloud.":::
<ToDo Diagram to be updated>

## Prerequisites

- An active Azure subscription. If you don't have one, [create a free account](https://azure.microsoft.com/free/).

  [!INCLUDE [the video analyzer account and storage account must be in the same subscription and region](../includes/note-account-storage-same-subscription.md)]

- Optionally, you would also need Azure Linux VM (with admin privileges) to host the RTSP camera simulator

## Sample Architecture - Recording video from a camera over the internet

> :::image type="content" source="./media/public-camera-to-cloud-livepipeline-sample.png" alt-text="Diagram of a live pipeline that captures live videos on the cloud.":::

## RTSP camera

You will need access to an RTSP capable camera [see for supported cameras](../quotas-limitations.md). The camera should be configured to encode video with a maximum bitrate under 3 Mbps. Make a note of this maximum bitrate setting. Further, the RTSP server on this camera needs to be accessible over the public internet. If you are able to use such a camera, then you can skip to Create Azure resources section.
Alternatively, you can deploy an RTSP camera simulator as described in the section below.

## Deploy RTSP camera simulator

This section shows you how to deploy an RTSP camera simulator on Azure Linux VM, running 'Ubuntu Server 18.04' operating systems. This simulator makes use of  the [Live555 Media Server](http://www.live555.com/mediaServer/).

> [!NOTE]
> References to third-party software are for informational and convenience purposes only. Microsoft does not endorse nor provide rights for the third-party software. For more information, see [Live555 Media Server](http://www.live555.com/mediaServer/).

> [!WARNING]
> Please note that this RTSP camera simulator endpoint is exposed over the internet, and hence will be accessible to anyone who knows the RTSP URL.

**Deployment steps:**
1. Deploy an standard D2 series Azure Linux VM, [see here](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/quick-create-portal).
1. Setup its networking configuration by going to VM Networking settings: 
    - Add inbound port rule: Set Destination port as 554, Protocol as any, ‘Allow’ Action for RTSP stream with other default values [see details here](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/nsg-quickstart-portal)
    - Also associate/pair a default subnet with VM’s NSG
1. Install docker on the VM using instructions [here](https://docs.docker.com/engine/install/ubuntu/)
1. Open terminal. Create <localfolder> on host VM, this folder will be used to map your host VM local folder to RTSP mediaserver container.
1. Cd to the <localfolder> location. Download MKV file by using `wget https://lvamedia.blob.core.windows.net/public/camera-1800s.mkv` command
1. Start the rtsp live555 media simulator container by command below, using pre-built rtspsim image that exists on the MCR 
    - `sudo docker run -d -p 554:554 -v ${PWD}/<localfolder>:/live/mediaServer/media mcr.microsoft.com/lva-utilities/rtspsim-live555:1.2`
    - Replace <localfolder> string with the folder created in previous steps, this will map your host VM local folder to RTSP mediaserver container
    - Random guid will be generated by docker if command runs correctly. You can run `docker ps` command to see RSTP simulator container is running on port 554
    - The video [camera-1800s.mkv file](https://lvamedia.blob.core.windows.net/public/camera-1800s.mkv) from the /media folder is used to simulate live video in this article
1. Now you have an RTSP server running on your VM, RTSP stream URL will be available to you: 
    - Go to your VM resource, copy the public IP of your VM from Overview top right pane
    - RTSP camera simulator URL will be `rtsp://<VMpublicIP>:554/media/camera-1800s.mkv`

## Create Azure resources

The next step is to create the required Azure resources (Video Analyzer account, storage account, and user-assigned managed identity). 

When you create an Azure Video Analyzer account, you have to associate an Azure storage account with it. If you use Video Analyzer to record the live video from a camera, that data is stored as blobs in a container in the storage account. You must use a managed identity to grant the Video Analyzer account the appropriate access to the storage account as follows.

[!INCLUDE [the video analyzer account and storage account must be in the same subscription and region](../includes/note-account-storage-same-subscription.md)]

### Create a Video Analyzer account in the Azure portal

1. Sign in at the [Azure portal](https://portal.azure.com/).
1. On the search bar at the top, enter **Video Analyzer**.
1. Select **Video Analyzers** under **Services**.
1. Select **Add**.
1. In the **Create Video Analyzer account** section, enter these required values:

   - **Subscription**: Choose the subscription that you're using to create the Video Analyzer account.
   - **Resource group**: Choose a resource group where you're creating the Video Analyzer account, or select **Create new** to create a resource group.
   - **Video Analyzer account name**: Enter a name for your Video Analyzer account. The name must be all lowercase letters or numbers with no spaces, and 3 to 24 characters in length.
   - **Location**: Choose a location to deploy your Video Analyzer account (for example, **West US 2**).
   - **Storage account**: Create a storage account. We recommend that you select a [standard general-purpose v2](../../../storage/common/storage-account-overview.md#types-of-storage-accounts) storage account.
   - **User identity**: Create and name a new user-assigned managed identity.

1. Select **Review + create** at the bottom of the form.

### Deploy a live pipeline

Once the Video Analyzer account is created, you can go ahead with next steps to create a live pipeline topology and a live pipeline.
1. Go to Video Analyzer account, and locate the **Live** menu item at the bottom left, select it. 
2. In the Topologies plane, select the **Create** option from the top to create a live topology. Follow the portal wizard steps to create a live topology
    - **Create a pipeline topology** blade will appear
    - For this getstarted document we will leverage prebuild sample topologies. Select **Try sample topologies**-> select **CVR from public camera** topology-> Click Proceed on **Load sample topology** dialog box.
    - Sample live topology 'RTSP source to Video sink' will appear on portal
    - Enter the required fields to create topology: 
        - **Topology name** – Enter the name for the topology 
        - **Description** (optional) – Brief description about the topology 
        - **Kind** (prepopulated ‘Live’), **SKU** (prepopulated ‘Live_S1’)
        - For **Rtsp source node**: **Transport** property set as TCP
        - Click **Save** with default configuration for rest of the properties
    - You will now see pipeline topology is created
3. Next step is to create a live pipeline using the topology created in previous step. 
    - Click **Pipelines**-> Select **Creat**e -> then select the ‘Live pipeline topology’ created in previous step to a create a pipeline. After selecting the topology click **Create**
    - **Create a live pipeline** blade will appear on the portal. Enter the required fields: 
        - **Live pipeline name** – Use a unique name, allows alpha numerals & dashes
        - **Bitrate** –  It is the maximum capacity in Kbps which is reserved for the live pipeline, allowed range is 500 to 3000 kbps. Use default 1000 for rtsp camera simulator camera-1800s.mkv file (this value should match with sample video file used). 
        - **rtspUserNameParameter**, **rtspPasswordParameter** - Set dummy values for these fields if using rtsp camera simulator else enter authentication credentials for actual rtsp camera stream
        - **rtspUrlParameter** – Use `rtsp://<VMpublicIP>:554/media/camera-1800s.mkv` (for RTSP camera simulator) else actual RTSP camera stream URL
        - **videoName** - Unique name for the target video resource to be recorded. Note: use a unique video resource for each camera (or MKV file)
    - Click **Create** and you will see a pipeline is created in the pipeline grid on the portal.
    - Select live pipeline created in the grid, click **Activate** option available towards the right of the pane to activate the live pipeline. This will start your live pipeline and start recording the video
1. Now you would be able to see the video resource under Video Analyzer account-> **Videos** pane in the portal. It’s status will indicate **Is in use** as pipeline is active and recording.
1. After a few seconds, click on the video, and you will be able to see the [low latency stream](../playback-recordings-how-to.md).

>    :::image type="content" source="./media/camera1800smkv.png" alt-text="Diagram of the recorded video captured by live pipeline on the cloud.":::

> [!NOTE]
> If you are using an RTSP camera simulator, it’s not possible to accurately determine end-to-end latency.

6. If necessary, refer Activity log to quickly verify your deployment operations.
7. To deactivate the pipeline recording go to Video Analyzer portal blade, select on the left panel select **Live**-> **Pipelines**-> select the pipeline to be deactivated then click **Deactivate** in pipeline grid, this will stop the recording. 
8. You can also proceed to delete the pipeline & topology if they are not needed.

## Clean up resources

If you want to try other quickstarts or tutorials, keep the resources that you created. Otherwise, go to the Azure portal, go to your resource groups, select the resource group where you ran this quickstart, and delete all the resources.

## Next steps

- Try out different MKV sample files for media simulator from [here](https://github.com/Azure/video-analyzer/tree/main/media) , bitrate of media sample file should match with pipeline setup.
- See supported cameras & limitations [here](../quotas-limitations.md)
- Learn more about [Monitoring & logging for cloud pipelines](/monitor-log-cloud.md).
