---
title: How to generate client access URL for the clients
description: How to generate client access URL for the clients
author: vicancy

ms.author: lianwei
ms.date: 04/25/2023
ms.service: azure-web-pubsub
ms.topic: how-to
---

# How to generate client access URL for the clients

A client, be it a browser ðŸ’», a mobile app ðŸ“±, or an IoT device ðŸ’¡, uses a **Client Access URL** to connect and authenticate with your resource. This URL follows a pattern of `wss://<service_name>.webpubsub.azure.com/client/hubs/<hub_name>?access_token=<token>`. This artcile shows you several ways to get the Client Access URL. 

- For quick start, copy one from the Azure portal
- For development, generate the value using [Web PubSub server SDK](./reference-server-sdk-js.md)
- If you are using Azure AD, you can also invoke the [Generate Client Token REST API](/rest/api/webpubsub/dataplane/web-pub-sub/generate-client-token)

## Copy from the Azure portal
In the Keys tab in Azure portal, there is a Client URL Generator tool to quickly generate a Client Access URL for you, as shown in the following diagram. Please note that values input here are not stored.

![The diagram shows how to get client access url.](./media/howto-websocket-connect/generate-client-url.png)

## Generate from service SDK
The same Client Access URL can be generated by using the Web PubSub server SDK.

# [JavaScript](#tab/javascript)

1. Follow [./reference-server-sdk-js.md#getting-started] to create a `WebPubSubServiceClient` object `service`

2. Generate Client Access URL by calling `WebPubSubServiceClient.getClientAccessToken`:
    * Configure user ID
        ```js
        let token = await serviceClient.getClientAccessToken({ userId: "user1" });
        ```
    * Configure the lifetime of the token
        ```js
        let token = await serviceClient.getClientAccessToken({ expirationTimeInMinutes: 5 });
        ```
    * Configure a role that can join group `group1` directly when it connects using this Client Access URL
        ```js
        let token = await serviceClient.getClientAccessToken({ roles: ["webpubsub.joinLeaveGroup.group1"] });
        ```
    * Configure a role that the client can send messages to group `group1` directly when it connects using this Client Access URL
        ```js
        let token = await serviceClient.getClientAccessToken({ roles: ["webpubsub.sendToGroup.group1"] });
        ```
    * Configure a group `group1` that the client will join once it connects using this Client Access URL
        ```js
        let token = await serviceClient.getClientAccessToken({ groups: ["group1"] });
        ```

# [C#](#tab/csharp)

1. Follow [./reference-server-sdk-csharp#getting-started] to create a `WebPubSubServiceClient` object `service`

2. Generate Client Access URL by calling `WebPubSubServiceClient.GetClientAccessUri`:
    * Configure user ID
        ```csharp
        var url = service.GetClientAccessUri(userId: "user1");
        ```
    * Configure the lifetime of the token
        ```csharp
        var url = service.GetClientAccessUri(expiresAfter: TimeSpan.FromMinutes(5));
        ```
    * Configure a role that can join group `group1` directly when it connects using this Client Access URL
        ```csharp
        var url = service.GetClientAccessUri(roles: new string[] { "webpubsub.joinLeaveGroup.group1" });
        ```
    * Configure a role that the client can send messages to group `group1` directly when it connects using this Client Access URL
        ```csharp
        var url = service.GetClientAccessUri(roles: new string[] { "webpubsub.sendToGroup.group1" });
        ```
    * Configure a group `group1` that the client will join once it connects using this Client Access URL
        ```csharp
        var url = service.GetClientAccessUri(groups: new string[] { "group1" });
        ```

# [Python](#tab/python)

1. Follow [./reference-server-sdk-python.md#install-the-package] to create a `WebPubSubServiceClient` object `service`

2. Generate Client Access URL by calling `WebPubSubServiceClient.get_client_access_token`:
    * Configure user ID
        ```python
        token = service.get_client_access_token(user_id="user1")
        ```
    * Configure the lifetime of the token
        ```python
        token = service.get_client_access_token(minutes_to_expire=5)
        ```
    * Configure a role that can join group `group1` directly when it connects using this Client Access URL
        ```python
        token = service.get_client_access_token(roles=["webpubsub.joinLeaveGroup.group1"])
        ```
    * Configure a role that the client can send messages to group `group1` directly when it connects using this Client Access URL
        ```python
        token = service.get_client_access_token(roles=["webpubsub.sendToGroup.group1"])
        ```
    * Configure a group `group1` that the client will join once it connects using this Client Access URL
        ```python
        token = service.get_client_access_token(groups=["group1"])
        ```

# [Java](#tab/java)

1. Follow [./reference-server-sdk-java.md#getting-started] to create a `WebPubSubServiceClient` object `service`

2. Generate Client Access URL by calling `WebPubSubServiceClient.getClientAccessToken`:
    * Configure user ID
        ```java
        GetClientAccessTokenOptions option = new GetClientAccessTokenOptions();
        option.setUserId(id);
        WebPubSubClientAccessToken token = service.getClientAccessToken(option);
        ```
    * Configure the lifetime of the token
        ```java
        GetClientAccessTokenOptions option = new GetClientAccessTokenOptions();
        option.setExpiresAfter(Duration.ofDays(1));
        WebPubSubClientAccessToken token = service.getClientAccessToken(option);
        ```
    * Configure a role that can join group `group1` directly when it connects using this Client Access URL
        ```java
        GetClientAccessTokenOptions option = new GetClientAccessTokenOptions();
        option.addRole("webpubsub.joinLeaveGroup.group1");
        WebPubSubClientAccessToken token = service.getClientAccessToken(option);
        ```
    * Configure a role that the client can send messages to group `group1` directly when it connects using this Client Access URL
        ```java
        GetClientAccessTokenOptions option = new GetClientAccessTokenOptions();
        option.addRole("webpubsub.sendToGroup.group1");
        WebPubSubClientAccessToken token = service.getClientAccessToken(option);
        ```
    * Configure a group `group1` that the client will join once it connects using this Client Access URL
        ```java
        GetClientAccessTokenOptions option = new GetClientAccessTokenOptions();
        option.setGroups(Arrays.asList("group1")),
        WebPubSubClientAccessToken token = service.getClientAccessToken(option);
        ```
---

In real-world code, we usually have a server side to host the logic generating the Client Access URL. When a client request comes in, the server side can leverage the general authentication/authorization workflow to validate the client request. Only valid client requests can get the Client Access URL back.

## Invoke the Generate Client Token REST API

You can enable Azure AD in your service and use the AAD token to invoke [Generate Client Token rest API](/rest/api/webpubsub/dataplane/web-pub-sub/generate-client-token) to get the token for the client to use.

1. Follow [Authorize from application](./howto-authorize-from-application.md) to enable Azure AD.
2. Get the AAD token with Postman:
    1. For the URI, enter `https://login.microsoftonline.com/<TENANT ID>/oauth2/token`. Replace `<TENANT ID>` with the **Directory (tenant) ID value** in the **Overview** tab of the application you created earlier.
    2. On the **Headers** tab, add **Content-Type** key and `application/x-www-form-urlencoded` for the value.
    3. Switch to the **Body** tab, and add the following keys and values.
        1. Select `x-www-form-urlencoded`.
        2. Add `grant_type` key, and type `client_credentials` for the value.
        3. Add `client_id` key, and paste the value of **Application (client) ID** in the **Overview** tab of the application you created earlier.
        4. Add `client_secret` key, and paste the value of client secret you noted down earlier.
        5. Add `resource` key, and type `https://webpubsub.azure.com` for the value.
    4. Select **Send** to send the request to get the token. You see the AAD token in the `access_token` field.
        [![How to get Azure AD token using postman](.media/howto-generate-client-access-url/get-azure-ad-token-using-postman-response.png)]
3. Use the AAD token to invoke `:generateToken` with Postman:
    1. For the URI, enter `https://{Endpoint}/api/hubs/{hub}/:generateToken?api-version=2022-11-01`
    2. On the **Auth** tab, select **Bearer Token** and paste the AAD token fetched in the previous step
    3. Select **Send** and you see the Client Access Token in the response:
        ```json
        {
            "token": "ABCDEFG.ABC.ABC"
        }   
        ```
4. The Client Access URI is in the format of `wss://<endpoint>/client/hubs/<hub_name>?access_token=<token>`

